<apex:page controller="NPD_ProjectDetailViewController_New"  sidebar="false"  action="{!storeProjectId}" >
      <apex:stylesheet value="{!$Page.NPDstyle}"></apex:stylesheet>
         
        <apex:stylesheet value="{!URLFOR($Resource.JqueryTree1, 'Boots/css/jquery.treegrid.css')}"/>
        <apex:includeScript value="{!URLFOR($Resource.JqueryTree1, 'Boots/js/jquery.min.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.JqueryTree1, 'Boots/js/jquery.treegrid.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.JqueryTree1, 'Boots/js/jquery.treegrid.bootstrap3.js')}"/>
        <apex:includescript value="{!URLFOR($Resource.JqueryTree1,'Boots/js/jquery.cookie.js')}"/>
        <apex:stylesheet value="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"/>
         <apex:stylesheet value="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"/>
         <link href='https://fonts.googleapis.com/css?family=Mako' rel='stylesheet' type='text/css'/>

    <script src="https://code.jquery.com/jquery-1.8.2.js"></script>
    <script src="/soap/ajax/26.0/connection.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/ui/1.9.0/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.9.1/themes/base/jquery-ui.css"/>      
    
        
        
        <!--  Don't delete this. if it is needed we have to be added -->
        <!--  <apex:includescript value="//cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js" />
        <script src="/soap/ajax/9.0/connection.js" type="text/javascript"></script>       
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"/>
        <script id="clientEventHandlersJS" type="javascript"></script>-->
        
        
        <script language="JavaScript">
        
        
        
        function setResult()
        {
           document.getElementById('j_id0:form:StgSubStgActvtySubActvtyBlck:StageEditBlock:Brand').readOnly=true;
                      document.getElementById('j_id0:form:StgSubStgActvtySubActvtyBlck:StageEditBlock:sub1').readOnly=true;

                        }
                        
                        window.onclick = setResult;
                        
                        
function setdata(myid)
{
   alert('this is is: '+ myid);
}
                       
        
function disableEnterKey(e)
{
     var key;

     if(window.event)
          key = window.event.keyCode;     //IE
     else
          key = e.which;     //firefox

     if(key == 13)
          return false;
     else
          return true;
}
</script>

<script>

function getpath(myid)
{
alert("Myid values is:"+myid);
}


 function getclikcingId(path)
  {
     var clickingid = path;
     
     alert(clickingid);
  
  }

</script>

<style>
.table_design {
    margin: 0 0 0 20px;
}.table_design table {
    border: 1px solid #ccc;
}
.table_design td, .table_design th {
    border-right: 1px solid #ccc;
    border-bottom: 1px solid #ccc;
    padding: 3px;
}
.popupclosebtn {
    position: absolute;
    right: 8px;
}
.popupclosebtn a {
    color: #fff;
}
.popup_title {
    background: #00b6b0;
    color: #fff;
    text-align: center;
    margin-bottom: 10px;
}
            .ontop1 {
                
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                display: none;
                position: absolute;             
                background: rgba(0, 0, 0, 0.5);
                color: #aaaaaa;
                
                
                
                
                
            }
            #popup1 {
                width: 500px;
                min-height: 200px;
                position: absolute;
                color: #000000;
               background-color: #ffffff;
                /* To align popup window at the center of screen*/
                top: 50%;
                left: 50%;
                margin-top: -100px;
                margin-left: -150px;border:none;
              
              
                border-radius: 5px;
            }
            
            #popupclosebtn
            {
             
            
            }
            
            #table_design
            {
            
            
            }
        </style>
        
        
        <script type="text/javascript">
            function pop(div) {
                document.getElementById(div).style.display = 'block';
            }
            function hide(div) {
                document.getElementById(div).style.display = 'none';
            }
            //To detect escape button
            document.onkeydown = function(evt) {
                evt = evt || window.event;
                if (evt.keyCode == 27) {
                    hide('popDiv');
                }
            };
        </script>
    
         <script type="text/javascript">
        var j$ = jQuery.noConflict();
        
        
        
        var apexAccountList =[];
          <apex:repeat value="{!snames}" var="strList">
            //Store the name of the account in the array variable.
               apexAccountList.push('{!strList}');
        </apex:repeat> 
      
         
     
        j$(document).ready(function(){
             
            j$("[id$=apexaccountautocomplete]").autocomplete({
                source : apexAccountList
            });
           
        });
        
        function callautocompleteagain()
        {
             j$(document).ready(function(){
             
            j$("[id$=apexaccountautocomplete]").autocomplete({
                source : apexAccountList
            });
           
        });
        
        }
    </script>  
        
        
        
        
        
        
        
         <style type="text/css">
         .selectui{
    border: none !important;
    width: 100% !important;
}
         
      .inputui{
      background:transparent !important;
      border:none !important;
      width:100% !important;
      
      }   
    
    .popupBackground {
  background: rgba(0, 0, 0, 0.8) none repeat scroll 0 0;
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
  z-index: 9998;
}
    .customPopup {
  
height: 400px;
  left: 4%;
  padding: 10px;
  position: fixed;
  top: 1%;
  width: 60%;
  z-index: 9999;border-radius: 10px;
  
  
}
    
    .disabledTextBox {
        background-color: white;
        border: 1px solid;
        color: black;
        cursor: default;
        width: 90px;
        display: table;
        padding: 2px 1px;
        text-align:right;
    }   
    
    .closeButton {
        float: right;
    }
    table.list{border:1px solid #000!important;}
    .list td,.list th{border-right:1px solid #000!important; border-bottom:1px solid #000!important;}
    </style>
    
        <style>
        .lookupimg{position: absolute;
        top: 3px;
        right: -15px;}
        .bordernone{border:none!important;}
        .homeTab .tertiaryPalette, .individualPalette .homeBlock .tertiaryPalette, .layoutEdit .individualPalette .homeBlock .tertiaryPalette {
        background-color: #00b6b0!important;
        border-color:#00b6b0!important;
    }
        .customnotabTab .tertiaryPalette, .individualPalette .customnotabBlock .tertiaryPalette, .layoutEdit .individualPalette .customnotabBlock .tertiaryPalette {
      background-color: #00b6b0!important;
      border-color: #00b6b0!important;
      font-family: 'Mako', sans-serif!important; font-size:14px;
    }.marginbottom15{margin-bottom:0px;}
        
        .btn {
      background-color: #095d80 !important;
      background-image: none !important;
      border: medium none !important;
      color: #fff !important;
      padding: 5px 10px !important;
    }
    .top-title {
        background-color: #09807c;
        border-radius: 5px 5px 0 0;
        color: #fff;
        font-size: 16px;
        margin-bottom: 2px;
        padding: 0px 0 0px 5px;
        font-family: 'Mako', sans-serif;
    }
        .top-titlewatch {
          background-color: #09807c;
          border-radius: 5px 5px 0 0;
          color: #fff;
          font-size: 20px;
          margin-bottom: 5px;
          padding: 5px 0 5px 10px;
          
          font-family: 'Mako', sans-serif;
        }
       .date-design {
          background: #cae5e4 none repeat scroll 0 0;
          border: 1px solid #00B6B0;
          display: inline-block;
          
          width: 100%;
          font-family: 'Mako', sans-serif;
        }
         .date-design label{
         font-size: 13px; 
         padding: 0;
         font-family: 'Mako', sans-serif;
         font-weight: normal;
         }
         .date-design .text {
          background-color: #fff;
          border-radius: 5px;
          color: #444;
         
          min-height: 25px;
          padding: 2px 5px;
          
          font-family: 'Mako', sans-serif;
        }
        .heading-title {
          background-color: #00b6b0;
          color: #fff;
          font-size: 14px;
          padding: 0px 10px; margin-bottom: 10px;
        }
        .datePicker{
         z-index: 1000  !important;
        }
         <!--   .bg-Activity{background-color:#E6E6E6!important;}
            .bg-SubActivity{background-color:#F2F2F2!important;}
            .bg-SubStage{background-color:#ccc!important;}
            .bg-Stage{background-color:#a6cccb!important;} -->
            
   
            .op-activity {background-color: #ff9900 !important;
    font-weight: bold !important;
}


            .op-completed{background-color: #3ADF00  !important;
    font-weight: bold  !important;
}


            .op-inprogress {background-color: #ffff00  !important;
    font-weight: bold !important;
}

            
            #blockbckanim{
                background-color:rgba(0, 14, 44, 0.7);
                width:100%;
                height:100%;
                position: absolute;
                top: 0px;
                left: 0px;
                z-index: 1000;
                rgba(0, 0, 0, 0.71);
                cursor: wait;
            }
             .treegrid{
                 background-color: #F3F3EC !important;
            }
            .table.tree-2{
                font-size:12px !important;
                background-color:#607d8b blue-grey !important;
                border : 1px;
                width:100%;
            }
            table.table-design{border-color:#ccc!important; }
            .table-design td, .table-design td{border-color:#ccc!important;}
            table.table-design tr:hover{background-color:#f2f2f2;   }
            table.table-design tr{background-color:#E0E6E8; }
            table.table-design th{
                background-color:#00b6b0;   
                color:#fff!important;
            }
            table.table-design:hover {
            box-shadow: 0 8px 17px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
                transition: background-color .25s ease;
            }
            
            .errormsgId{
                background-color: #f9f9f9 !important;;
            }
             .successmsgId{
                background-color: #f9f9f9!important;;
            }
            .h_search {
  margin-bottom: 5px;
  text-align: center;
}
.h_search input[type="text"] {
  border: 1px solid #ccc;
  border-radius: 5px;
  margin: 0 5px;
  padding: 2px 7px;
}
        </style>
           <script> onload(); 
        function showimage(){
            
            var et= document.getElementsByClassName("popup21")
            et[0].style.display="block";
        }
        
        function hideimage(){
             var et= document.getElementsByClassName("popup21")
             et[0].style.display="none";
             
        }
        
       
        
        </script>
        <script> onload(); </script>
        
        
        <div id="blockbckanim" style="display:none;text-align:center;">
                <apex:outputText id="theImage" style="margin-top:200px;color:#fff;width:37px;height:37px;border:0;" styleClass="fa fa-clock-o fa-pulse fa-3x fa-fw" />
        </div>
        <apex:form id="form">
        
        
     
       <div class="h_search"  onKeyPress="return disableEnterKey(event)" >
       <div style="float:left" >
        <apex:commandLink value="Click to view Marketing Brief/Concept Stage" onClick="openMarketStage('{!currentProject.Marketing_Brief_Stage__c}');" rendered="{!currentProject.Marketing_Brief_Stage__c != NULL}" rerender="form" status="actStatusId" onComplete="callTablegrid();" />
        </div>
        
        <div style="float:right" >
        <!-- <label>Enter Name:</label> -->
          <apex:outputpanel id="searchfunction" >
          <apex:inputtext id="apexaccountautocomplete" value="{!autostring}" html-placeholder="Search With Name"  /> <!-- <apex:commandbutton value="Search" action="{!getrecord}"   rerender="blockbckanim" oncomplete="editprojectdata('{!presentid}','view')"  />   -->
            <apex:commandlink action="{!getrecord}"   rerender="blockbckanim" oncomplete="editprojectdata('{!presentid}','view')" status="actStatusId"><apex:image url="{!$Resource.magnifiersearch}" width="30" height="30" />  </apex:commandlink>   
            </apex:outputpanel>
          </div>  </div> <br/><br/>
            
            
            
            <apex:actionStatus id="actStatusId" onStart="ShowLoading();" onstop="HideLoading();" />
            <apex:actionfunction name="onLoad" action="{!prepareMapForStageAndActivities}" rerender="DetailPanel,CollectionName" status="actStatusId" onComplete="callTablegrid();"/>
            <apex:outputpanel id="CollectionName" >
                <div class="top-title" ><apex:outputText value="{!currentProject.NPD_Collections__r.Collection_Name__c}"></apex:outputText><apex:outputText value=" - " rendered="{!if(currentProject.Model_No__c!=NULL,true,false)}"/><apex:outputText value="{!currentProject.Model_No__c}" escape="false"  rendered="{!if(currentProject.Model_No__c!=NULL,true,false)}"></apex:outputText>
                </div>
                <div >  <!-- <apex:outputField value="{!currentProject.ImageUpload__c}" style="width: 10px; height: 30px; ">   </apex:outputField> -->
                       <apex:image value="{!imagepiclink}"  width="50px" height="50"  rendered="{!if(currentProject.ImageUpload__c!=NULL,true,false)}"   onmouseover="showimage();" onmouseout="hideimage();" />
                  <!--<apex:commandLink value="    View" onmouseover="showimage();" onmouseout="hideimage();" reRender="CollectionName" rendered="{!if(currentProject.ImageUpload__c!=NULL,true,false)}"/>-->
                <!--       <apex:outputText value="<b>{!currentProject.Model_No__c}</b>" escape="false"  rendered="{!if(currentProject.Model_No__c!=NULL,true,false)}"></apex:outputText>    -->
    
                </div> 
                 <apex:outputPanel styleClass="popup21" style="display:none;">
                <apex:outputPanel styleClass="customPopup" layout="block" >
                <table>
                    <tr>
                        <td id="rich2">
                        <!-- <apex:outputField value="{!currentProject.ImageUpload__c}" /> -->
                                                <apex:image value="{!imagepiclink}"  rendered="{!if(currentProject.ImageUpload__c!=NULL,true,false)}"  style="left:10px;top:10px;"  />

                        
                    
    
                        </td>
                        
                     </tr>
                 </table>
                    
                </apex:outputPanel>
            </apex:outputPanel>
                  
            </apex:outputpanel>
            <apex:outputpanel id="viewPanel" >
             <!-- Main Page table view -->
             
            <apex:outputpanel id="DetailPanel" rendered="{!(event != 'view') && (event != 'edit')}">
                <table  id="tableId" class="table tree-2 table-design" border="1">
                    <tr>
                        <th width="50%" rowspan="2" style="text-align:center; vertical-align: middle;" > Name </th>
                        <th rowspan="2" style="text-align:center; vertical-align: middle;"> Type </th>
                        <th colspan="2" style="text-align:center"> Lead Time </th>
                        <th colspan="2" style="text-align:center"> Planned Date </th>
                        <th colspan="2" style="text-align:center"> Actual Date </th>
                        <th rowspan="2" style="text-align:center; vertical-align: middle;"> Status </th>
                        <th width="10%" rowspan="2" style="text-align:center; vertical-align: middle;"> View/Edit  </th>
                        <th rowspan="2" style="text-align:center; vertical-align: middle;"> Function Name </th>
                        <th rowspan="2" style="text-align:center; vertical-align: middle;"> Responsibility </th>
                        <th rowspan="2" style="text-align:center; vertical-align: middle;"> Complexity </th>
                        <th rowspan="2" style="text-align:center; vertical-align: middle;"> Attachment </th>
                        <th rowspan="2" style="text-align:center; vertical-align: middle;"> Action </th>
                    </tr>
                    
                    <tr>
                        <th style="text-align:center"> Plan  </th> <th style="text-align:center"> Actual </th>
                        <th style="text-align:center"> Start </th> <th style="text-align:center"> End    </th>
                        <th style="text-align:center"> Start </th> <th style="text-align:center"> End    </th>
                    </tr>
                    
                    <!-- Stage Iteration -->
                    <apex:variable value="{!1}" var="itemPosition"/> 
                    <apex:repeat value="{!stageMap}" var="Stage" id="stageRepeat">
                    
                        <tr class="treegrid-{!itemPosition}" id="node1-{!itemPosition}">
                        
                           <td ><apex:outputtext Title="{!stageMap[Stage].Name__c}" value="<b>{!stageMap[Stage].Name__c}</b>"  escape="false" /></td> <!--{!left(stageMap[Stage].Name__c,23)} Stage Name -->
                            <td><apex:outputtext value="{!stageMap[Stage].Type__c}"  styleClass="StageClass"/></td> <!-- Stage Type -->
                            <td><apex:outputtext value="{!stageMap[Stage].Planned_Lead_Time__c}"  /></td> <!-- Stage Planned lead time-->
                            <td><apex:outputtext value="{!stageMap[Stage].Actual_Lead_Time__c}"  /></td>  <!-- Stage Actual lead time-->
                            <td><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!stageMap[Stage].Planned_Start_Date__c}" /> </apex:outputText> </td> <!-- Stage Planned Start time-->
                            <td><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!stageMap[Stage].Planned_End_Date__c}" /> </apex:outputText> </td> <!-- Stage Planned End time-->
                            <td><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!stageMap[Stage].Actual_Start_Date__c}" /> </apex:outputText> </td> <!-- Stage Actual Start time-->
                            <td><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!stageMap[Stage].Actual_End_Date__c}" /> </apex:outputText> </td> <!-- Stage Actual End time-->                   
                            <td><p><apex:outputtext value="{!stageMap[Stage].Status__c}" styleclass="{!if(stageMap[Stage].Status__c == 'Not Started','notStarted',if(stageMap[Stage].Status__c == 'In Progress','inProgress',if(stageMap[Stage].Status__c == 'Completed','completed','defer')))}" /></p></td> <!-- Stage Status -->
                            <td> 
                            
                            
                            
                            <!-- Stage View/Edit -->
                                <apex:commandLink style="padding-left:25px;" id="StageViewId" value="View" onclick="if(!editprojectdata1('{!stageMap[Stage].id}','view')) return false;"  rendered="{!stageMap[Stage].Active__c==true}" title="View Stage" immediate="true"/> <!-- |&nbsp; -->
                                
                                
                             <!--    <apex:outputPanel rendered="{!IF ( OR(  AND ( OR($User.Alias=='cped',$User.Username=='duraisamy_npd@titan.co.in' ),stageMap[Stage].Name__c =='Marketing Brief/Concept'   ), AND( $User.Username=='csaravanan_npd@titan.co.in',stageMap[Stage].Name__c !='Marketing Brief/Concept')) , false,true)}" > -->
                                
                                
                                
                                                
                                
                                
                                <apex:outputText value=" | " rendered="{!stageMap[Stage].Active__c==true}"/>
                                                            
                                <apex:commandLink id="StageEditId" value="Edit" onclick="if(!editprojectdata1('{!stageMap[Stage].id}','edit')) return false;" rendered="{!stageMap[Stage].Active__c==true  }" title="Edit Stage" immediate="true"/>
                              <!--  </apex:outputPanel> -->

                           </td> 
                                    



                            <!--<td><apex:image id="EditId" value="{!$Resource.EditImage}" width="30" height="30" onclick="editprojectdata1('{!stageMap[Stage].id}','view')" rendered="{!stageMap[Stage].Active__c==true}" title="View Stage"/></td> -->  
                            <td><apex:outputtext value="{!stageMap[Stage].Function_Name__c}" /></td> <!-- Stage Function Name -->
                            <td><apex:outputtext value="{!stageMap[Stage].NPD_User__r.Name}" /></td> <!-- Stage Responsibility -->
                            <td><apex:outputtext value="{!stageMap[Stage].Complexity_typess__c}" /></td> <!-- Stage Complexity -->
                            <td style="text-align:center"><apex:image id="AttchIcon" value="{!$Resource.AttachmentIcon}" width="20" height="20" rendered="{!stageMap[Stage].Attachments.size > 0}" /></td> <!-- Stage contains attachment -->
                            <td>  <!-- Stage Activate/Deactivate -->     
                                <apex:commandLink value="Click to Activate" immediate="true" action="{!processActiveDeactivestage}"   reRender="DetailPanel" status="actStatusId" onComplete="callTablegrid();"   rendered="{!stageMap[Stage].Active__c== false}"    >
                                    <apex:param name="strActid" value="{!stageMap[Stage].id}" assignTo="{!tempstageid}"/>
                                </apex:commandLink> 
                              <apex:commandLink value="Click to Deactivate" immediate="true" action="{!processActiveDeactivestage}"  reRender="DetailPanel" status="actStatusId" onComplete="callTablegrid();"   rendered="{!stageMap[Stage].Active__c== true}" >  
                                    <apex:param name="strActid" value="{!stageMap[Stage].id}" assignTo="{!tempstageid}"/>
                                </apex:commandLink> 
                            </td> 
                                     
                        </tr>
                        
                        <!-- Sub-Stage Iteration -->
                        <apex:variable value="{!itemPosition}" var="StagePosition"/>
                        <apex:repeat value="{!subStageMap[Stage]}" var="SubtageStage" id="substageRepeat"> 
                            <apex:variable value="{!itemPosition+1}" var="itemPosition"/>           
                                <tr class="treegrid-{!itemPosition} treegrid-parent-{!StagePosition}" id="node2-{!itemPosition}"  >
                                    <td> <!-- Stage Name -->
                                    
                                    
                                        <apex:outputtext Title="{!SubtageStage.Name__c}" value="{!SubtageStage.Name__c}"/><br/><!--{!left(SubtageStage.Name__c,23)}.....-->
                                    <div style="float:right">     <apex:commandLink id="ViewOptSubStg" value="View Optional" title="Sub-Stage" action="{!showHideSubStage}"  rendered="{!AND(SubtageStage.Optional_Sub_Stages__c != null, NOT(CONTAINS(SubtageStage.Optional_Sub_Stages__c,':##SHOWN')))}"  status="actStatusId" style="font-weight: bold;font-size:x-small;color: red;" > <!-- rendered="{!IF(AND(SubtageStage.Optional_Sub_Stages__c != null, NOT(CONTAINS(SubtageStage.Optional_Sub_Stages__c,',SHOWN'))),'true','false')}" -->  
                                            <apex:param name="strActid" value="{!SubtageStage.id}" assignTo="{!childId}"/>
                                            <apex:param name="recHidden" value="true" assignto="{!isRecHidden}"/>
                                            <apex:param name="parentId" value="{!SubtageStage.NPD_Stage__c}" assignTo="{!parentID}"/>
                                        </apex:commandLink>
                                        <apex:commandLink id="HideOptSubStg" value="Hide Optional" title="Sub-Stage" action="{!showHideSubStage}" rendered="{!AND(SubtageStage.Optional_Sub_Stages__c != null, CONTAINS(SubtageStage.Optional_Sub_Stages__c,':##SHOWN'))}"  status="actStatusId"   style="font-weight: bold;font-size:x-small;color: red;" ><!--  && (isHidden == true) -->
                                            <apex:param name="strActid" value="{!SubtageStage.id}" assignTo="{!childId}"/>
                                            <apex:param name="recHidden" value="false" assignto="{!isRecHidden}"/>
                                            <apex:param name="parentId" value="{!SubtageStage.NPD_Stage__c}" assignTo="{!parentID}"/>
                                        </apex:commandLink>   </div>
                                        
                                        
                                    </td>
                                    <td><apex:outputtext value="{!SubtageStage.Type__c}"  styleClass="SubStageClass"/></td> <!-- Sub-Stage Type -->
                                    <td><apex:outputtext value="{!SubtageStage.Planned_Lead_Time__c}"  /></td> <!-- Sub-Stage Planned lead time-->
                                    <td><apex:outputtext value="{!SubtageStage.Actual_Lead_Time__c}"  /></td> <!-- Sub-Stage Actual lead time-->>
                                    <td><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!SubtageStage.Planned_Start_Date__c}" /> </apex:outputText> </td> <!-- Sub-Stage Planned Start time-->
                                    <td><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!SubtageStage.Planned_End_Date__c}"  /> </apex:outputText> </td>  <!-- Sub-Stage Planned End time-->
                                    <td><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!SubtageStage.Actual_Start_Date__c}" /> </apex:outputText> </td> <!-- Sub-Stage Actual Start time-->
                                    <td><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!SubtageStage.Actual_End_Date__c}" /> </apex:outputText> </td> <!-- Sub-Stage Actual End time-->         
                                    <td><p><apex:outputtext value="{!SubtageStage.Status__c}"  styleclass="{!if(SubtageStage.Status__c == 'Not Started','notStarted',if(SubtageStage.Status__c == 'In Progress','inProgress',if(SubtageStage.Status__c == 'Completed','completed','defer')))}"/></p></td> <!-- Sub-Stage Status -->
                                                <!--<td><apex:image id="EditId" value="{!$Resource.EditImage}"  width="20" height="20" onclick="editprojectdata1('{!SubtageStage.id}','view')" rendered="{!SubtageStage.Active__c==true}" title=" View Sub-Stage" /> &nbsp;
                                                <apex:image id="EditIdPencil" value="{!$Resource.EditIconPencil}"  width="20" height="20" onclick="editprojectdata1('{!SubtageStage.id}','edit')" rendered="{!SubtageStage.Active__c==true}" title=" View Sub-Stage" /></td>-->
                                    <td> <!-- Sub-Stage View/Edit -->
                                        <apex:commandLink style="padding-left:25px;" id="SubStageViewId" value="View" onclick="if(!editprojectdata1('{!SubtageStage.id}','view')) return false;" rendered="{!(stageMap[Stage].Active__c==true && SubtageStage.Active__c == true)}" title=" View Sub-Stage" immediate="true"/> <!-- |&nbsp; -->
                                        <apex:outputText value=" | " rendered="{!(stageMap[Stage].Active__c==true && SubtageStage.Active__c == true)}"/>
                                       
                               <!--      <apex:outputPanel rendered="{!IF ( OR(  AND ( OR($User.Alias=='cped',$User.Username=='duraisamy_npd@titan.co.in' ),stageMap[Stage].Name__c =='Marketing Brief/Concept'   ), AND( $User.Username=='csaravanan_npd@titan.co.in',stageMap[Stage].Name__c !='Marketing Brief/Concept')) , false,true)}" >  -->

                                       <apex:commandLink id="SubStageEditId" value="Edit" onclick="if(!editprojectdata1('{!SubtageStage.id}','edit')) return false;" rendered="{!(stageMap[Stage].Active__c==true && SubtageStage.Active__c == true)}" title=" Edit Sub-Stage" immediate="true"/>
                                       
                                     
                                      
                                  <!--   </apex:outputpanel>  -->
                                    </td>
                                    <td><apex:outputtext value="{!SubtageStage.Function_Name__c}" /></td> <!-- Sub-Stage Function Name -->
                                    <td><apex:outputtext value="{!SubtageStage.NPD_User__r.Name}" /></td> <!-- Sub-Stage Responsibility -->
                                    <td><apex:outputtext value="{!SubtageStage.Complexity_typess__c}"  /></td> <!-- Sub-Stage Complexity -->
                                    <td style="text-align:center"><apex:image id="AttchIcon" value="{!$Resource.AttachmentIcon}" width="20" height="20" rendered="{!SubtageStage.Attachments.size > 0}" /></td> <!-- Sub-Stage contains attachment -->
                                    <td> <!-- Sub-Stage Activate/Deactivate -->     
                                        <apex:commandLink value="Click to Activate" immediate="true" action="{!processActiveDeactiveForSubstage}"  reRender="DetailPanel" status="actStatusId" onComplete="window.location.reload()"  rendered="{!((stageMap[Stage].Active__c==false && SubtageStage.Active__c == false) || (stageMap[Stage].Active__c==true&& SubtageStage.Active__c == false))}"  >
                                            <apex:param name="strActid" value="{!SubtageStage.id}" assignTo="{!childId}"/>
                                            <apex:param name="parentId" value="{!SubtageStage.NPD_Stage__c}" assignTo="{!parentID}"/>
                                        </apex:commandLink>  
                                        <apex:commandLink value="Click to Deactivate" immediate="true" action="{!processActiveDeactiveForSubstage}"   reRender="DetailPanel" status="actStatusId" onComplete="window.location.reload()" rendered="{!(stageMap[Stage].Active__c==true&& SubtageStage.Active__c == true)}" >
                                            <apex:param name="strActid" value="{!SubtageStage.id}" assignTo="{!childId}"/>
                                            <apex:param name="parentId" value="{!SubtageStage.NPD_Stage__c}" assignTo="{!parentID}"/>
                                        </apex:commandLink>
                                     </td>
                                </tr>
                            
                            <!-- Activity Iteration -->             
                            <apex:variable value="{!itemPosition}" var="SubStagePosition"/>
                            <apex:repeat value="{!activityMap[SubtageStage.id]}" var="Activity" id="activityRepeat">
                                <apex:variable value="{!itemPosition+1}" var="itemPosition"/>            
                                    <tr class="treegrid-{!itemPosition} treegrid-parent-{!SubStagePosition}" id="node3-{!itemPosition}">
                                        <td> <!-- Activity Name -->
                                            <apex:outputtext Title="{!Activity.Name__c}" value="{!Activity.Name__c}" /><br/><!--{!left(Activity.Name__c,23)}.....-->
                                      <!--    <div style="float:right">   <apex:commandLink id="ViewOptActvty" value="View Optional" title="Activity" action="{!showHideActivity}"  rendered="{!AND(Activity.Optional_Activity_Sub_Activity__c != null, NOT(CONTAINS(Activity.Optional_Activity_Sub_Activity__c,':##SHOWN')))}"   style="font-weight: bold;font-size:x-small;color: red;" > 
                                                <apex:param name="strActid" value="{!Activity.id}" assignTo="{!childId}"/>
                                                <apex:param name="recHidden" value="true" assignto="{!isRecHidden}"/>
                                                <apex:param name="parentId" value="{!Activity.NPD_Stage__c}" assignTo="{!parentID}"/>
                                            </apex:commandLink>
                                            <apex:commandLink id="HideOptActvty" value="Hide Optional" title="Activity" action="{!showHideActivity}" rendered="{!AND(Activity.Optional_Activity_Sub_Activity__c != null, CONTAINS(Activity.Optional_Activity_Sub_Activity__c,':##SHOWN'))}"   style="font-weight: bold;font-size:x-small;color: red;" >
                                                <apex:param name="strActid" value="{!Activity.id}" assignTo="{!childId}"/>
                                                <apex:param name="recHidden" value="false" assignto="{!isRecHidden}"/>
                                                <apex:param name="parentId" value="{!Activity.NPD_Stage__c}" assignTo="{!parentID}"/>
                                            </apex:commandLink></div>-->
                                        </td>  
                                        <td><apex:outputtext value="{!Activity.Type__c}"  styleClass="ActivityClass"/></td> <!-- Activity Type -->
                                        <td><apex:outputtext value="{!Activity.Planned_Lead_Time__c}"  /></td> <!-- Activity Planned Lead Time -->
                                        <td><apex:outputtext value="{!Activity.Lead_Time__c}"  /></td> <!-- Activity Actual Lead Time -->
                                        <td></td> <!-- Activity Planned Start Time -->
                                        <td></td> <!-- Activity Planned End Time -->
                                        <td><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!Activity.Actual_Start_Date__c}" /> </apex:outputText> </td> <!-- Activity Actual Start Time-->
                                        <td><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!Activity.Actual_End_Date__c}" /> </apex:outputText> </td> <!-- Activity Actual End Time-->
                                        <td><p><apex:outputtext value="{!Activity.Status__c}" styleclass="{!if(Activity.Status__c == 'Not Started','notStarted',if(Activity.Status__c == 'In Progress','inProgress',if(Activity.Status__c == 'Completed','completed','defer')))}" /></p></td> <!-- Activity Status -->
                                                <!--<td><apex:image id="EditId" value="{!$Resource.EditImage}" width="30" height="30" onclick="editprojectdata('{!Activity.id}','view')" rendered="{!Activity.Active__c==true}"  title=" View Activity" /></td>-->
                                        <td> <!-- Activity View/Edit -->
                                            <apex:commandLink style="padding-left:25px;" id="ActivityViewId" value="View" onclick="if(!editprojectdata('{!Activity.id}','view')) return false;"  rendered="{!(stageMap[Stage].Active__c==true && SubtageStage.Active__c==true && Activity.Active__c == true)}" title=" View Activity" immediate="true"/> <!-- |&nbsp; -->
                                            <apex:outputText value=" | "  rendered="{!(stageMap[Stage].Active__c==true && SubtageStage.Active__c==true && Activity.Active__c == true)}"/>
                                           
                                          <!--   <apex:outputPanel rendered="{!IF ( OR(  AND ( OR($User.Alias=='cped',$User.Username=='duraisamy_npd@titan.co.in' ),stageMap[Stage].Name__c =='Marketing Brief/Concept'   ), AND( $User.Username=='csaravanan_npd@titan.co.in',stageMap[Stage].Name__c !='Marketing Brief/Concept')) , false,true)}" >  -->
                                           <apex:commandLink id="ActivityEditId" value="Edit" onclick="if(!editprojectdata('{!Activity.id}','edit')) return false;"  rendered="{!(stageMap[Stage].Active__c==true && SubtageStage.Active__c==true && Activity.Active__c == true &&  Activity.approval_status__c != 'Pending')}" title=" Edit Activity" immediate="true"/>
                                           
                                         <!--  </apex:outputpanel> -->
                                           
                                        </td> 
                                        <td><apex:outputtext value="{!Activity.Function_Name__c}" /></td> <!--Activity Function Name -->
                                        <td><apex:outputtext value="{!Activity.NPD_User__r.Name}" /></td> <!--Activity Responsibility -->
                                        <td><apex:outputtext value="{!Activity.Complexity_typess__c}"  /></td> <!--Activity Complexity -->
                                        <td style="text-align:center"><apex:image id="AttchIcon" value="{!$Resource.AttachmentIcon}" width="20" height="20" rendered="{!Activity.Attachments.size > 0}" /></td> <!--Activity contains attachment -->
                                        <td> <!-- Activity Activate/Deactivate -->
                                            <apex:commandLink value="Click to Activate" immediate="true" action="{!processActiveDeactiveForActivity}"  status="actStatusId" id="Active" reRender="DetailPanel" onComplete="window.location.reload()"   rendered="{!((stageMap[Stage].Active__c==false && SubtageStage.Active__c==false&& Activity.Active__c == false) || (stageMap[Stage].Active__c==true && SubtageStage.Active__c=true && Activity.Active__c==false))}"   >
                                                <apex:param name="strActid" value="{!Activity.id}" assignTo="{!childId}"/>
                                                <apex:param name="parentId" value="{!Activity.NPD_Stage__c}" assignTo="{!parentID}"/>
                                            </apex:commandLink> 
                                            <apex:commandLink value="Click to Deactivate" immediate="true" action="{!processActiveDeactiveForActivity}"  status="actStatusId" id="Deactive" reRender="DetailPanel" onComplete="window.location.reload()"  rendered="{!(stageMap[Stage].Active__c==true && SubtageStage.Active__c==true && Activity.Active__c == true )}" >
                                                <apex:param name="strActid" value="{!Activity.id}" assignTo="{!childId}"/>
                                                <apex:param name="parentId" value="{!Activity.NPD_Stage__c}" assignTo="{!parentID}"/>
                                            </apex:commandLink>
                                        </td>                
                                    </tr>
                                
                                <!-- Sub-Activity Iteration -->     
                                <apex:variable value="{!itemPosition}" var="ActivityPosition"/>
                                <apex:repeat value="{!subActivityMap[Activity.id]}" var="subActivity" id="subActivityRepeat">
                                    <apex:variable value="{!itemPosition+1}" var="itemPosition"/>                         
                                        <tr class="treegrid-{!itemPosition} treegrid-parent-{!ActivityPosition}" id="node4-{!itemPosition}">
                                            <td>    <!-- Sub-Activity Name -->
                                            
                                                 <a onclick="collapseall()" ><span class="glyphicon glyphicon-arrow-up"></span></a> 
                                                <apex:outputtext Title="{!subActivity.Name__c}" value="{!subActivity.Name__c}" /><br/><!--{!left(subActivity.Name__c,23)}.....-->
                                            <div style="float:right">     <apex:commandLink id="ViewOptSubActvty" value="View Optional" title="Sub-Activity" action="{!showHideSubActivity}"  rendered="{!AND(subActivity.Optional_Activity_Sub_Activity__c != null, NOT(CONTAINS(subActivity.Optional_Activity_Sub_Activity__c,':##SHOWN')))}"   style="font-weight: bold;font-size:x-small;color: red;" >   
                                                    <apex:param name="strActid" value="{!subActivity.id}" assignTo="{!childId}"/>
                                                    <apex:param name="recHidden" value="true" assignto="{!isRecHidden}"/>
                                                    <apex:param name="parentId" value="{!subActivity.NPD_Activity__c}" assignTo="{!parentID}"/>
                                                </apex:commandLink>
                                                <apex:commandLink id="HideOptSubActvty" value="Hide Optional" title="Sub-Activity" action="{!showHideSubActivity}" rendered="{!AND(subActivity.Optional_Activity_Sub_Activity__c != null, CONTAINS(subActivity.Optional_Activity_Sub_Activity__c,':##SHOWN'))}"    style="font-weight: bold;font-size:x-small;color: red;" >
                                                    <apex:param name="strActid" value="{!subActivity.id}" assignTo="{!childId}"/>
                                                    <apex:param name="recHidden" value="false" assignto="{!isRecHidden}"/>
                                                    <apex:param name="parentId" value="{!subActivity.NPD_Activity__c}" assignTo="{!parentID}"/>
                                                </apex:commandLink> </div>
                                            </td>
                                            <td><apex:outputtext value="{!subActivity.Type__c}"  styleClass="SubActivityClass"/></td> <!-- Sub-Activity Type -->
                                            <td><apex:outputtext value="{!subActivity.Planned_Lead_Time__c}"  /></td> <!-- Sub-Activity Planned Lead Time -->
                                            <td><apex:outputtext value="{!subActivity.Lead_Time__c}"  /></td> <!-- Sub-Activity Actual Lead Time -->
                                            <td></td> <!-- Sub-Activity Planned Start Time -->
                                            <td></td> <!-- Sub-Activity Planned End Time -->
                                            <td><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!subActivity.Actual_Start_Date__c}" /> </apex:outputText> </td> <!-- Sub-Activity Actual Start Time-->
                                            <td><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!subActivity.Actual_End_Date__c}" /> </apex:outputText> </td> <!-- Sub-Activity Actual End Time-->
                                            <td><p><apex:outputtext value="{!subActivity.Status__c}" styleclass="{!if(subActivity.Status__c == 'Not Started','notStarted',if(subActivity.Status__c == 'In Progress','inProgress',if(subActivity.Status__c == 'Completed','completed','defer')))}" /></p></td>  <!-- Sub-Activity Status -->
                                                    <!-- <td><apex:image id="EditId" value="{!$Resource.EditImage}" width="30" height="30" onclick="editprojectdata('{!subActivity.id}','view')" rendered="{!Activity.Active__c==true}"  title="View Sub-Activity" /></td>-->
                                            <td>  <!-- Sub-Activity View/Edit -->
                                                <apex:commandLink style="padding-left:25px;" id="SubActivityViewId" value="View" onclick="if(!editprojectdata('{!subActivity.id}','view')) return false;" rendered="{!(stageMap[Stage].Active__c==true && SubtageStage.Active__c && Activity.Active__c==true && subActivity.Active__c == true)}" title=" View Sub-Activity" immediate="true"/> <!-- |&nbsp; -->
                                                <apex:outputText value=" | "  rendered="{!(stageMap[Stage].Active__c==true && SubtageStage.Active__c && Activity.Active__c==true && subActivity.Active__c == true)}"/>
                                               


                                     <!--    <apex:outputPanel rendered="{!IF ( OR(  AND ( OR($User.Alias=='cped',$User.Username=='duraisamy_npd@titan.co.in' ),stageMap[Stage].Name__c =='Marketing Brief/Concept'   ), AND( $User.Username=='csaravanan_npd@titan.co.in',stageMap[Stage].Name__c !='Marketing Brief/Concept')) , false,true)}" >  -->

                                               <apex:commandLink id="SubActivityEditId" value="Edit" onclick="if(!editprojectdata('{!subActivity.id}','edit')) return false;"  rendered="{!(stageMap[Stage].Active__c==true && SubtageStage.Active__c &&Activity.Active__c==true && subActivity.Active__c == true  &&  subActivity.approval_status__c != 'Pending')}" title=" Edit Sub-Activity" immediate="true"/>
                                               
                                          <!--     </apex:outputpanel> -->
                                               
                                            </td>
                                            <td><apex:outputtext value="{!subActivity.Function_Name__c}" /></td> <!-- Sub-Activity Function Name -->
                                            <td><apex:outputtext value="{!subActivity.NPD_User__r.Name}" /></td> <!-- Sub-Activity Responsibility -->
                                            <td><apex:outputtext value="{!subActivity.Complexity_typess__c}"  /></td>  <!-- Sub-Activity Complexity -->
                                            <td style="text-align:center"><apex:image id="AttchIcon" value="{!$Resource.AttachmentIcon}" width="20" height="20" rendered="{!subActivity.Attachments.size > 0}" /></td> <!-- Sub-Activity contains attachment -->
                                            <td>
                                                <apex:commandLink value="Click to Activate" immediate="true"  action="{!processActiveDeactiveSubActivity}" status="actStatusId"   reRender="DetailPanel" onComplete="callTablegrid();" rendered="{!((stageMap[Stage].Active__c==false && SubtageStage.Active__c=false && Activity.Active__c==false) || (stageMap[Stage].Active__c==true && SubtageStage.Active__c=true && Activity.Active__c==true && subActivity.Active__c == false))}"   >
                                                    <apex:param name="strActid" value="{!subActivity.id}" assignTo="{!childId}"/>                                     
                                                    <apex:param name="parentId" value="{!subActivity.NPD_Activity__c }" assignTo="{!parentID}"/>
                                                </apex:commandLink>
                                                <apex:commandLink value="Click to Deactivate" immediate="true" action="{!processActiveDeactiveSubActivity}" status="actStatusId" reRender="DetailPanel" onComplete="callTablegrid();"    rendered="{!(stageMap[Stage].Active__c==true && SubtageStage.Active__c=true && Activity.Active__c==true && subActivity.Active__c == true)}" > 
                                                  <apex:param name="strActid" value="{!subActivity.id}" assignTo="{!childId}"/>
                                                    <apex:param name="parentId" value="{!subActivity.NPD_Activity__c }" assignTo="{!parentID}"/>
                                                </apex:commandLink>
                                                <br/> <br/>
                                                <apex:commandButton value="New Project" action="{!newProject}" styleclass="color:red;" rendered="{!AND(RIGHT(subActivity.Name__c,19) == 'E Plant/IND Vendors',currentProject.Model_No__c==NULL)}"/> 
                                            </td>
                                        </tr>
                                </apex:repeat> <!--End of Sub-Activity Iteration-->
                            </apex:repeat> <!--End of Activity Iteration-->
                        </apex:repeat> <!--End of Sub-Stage Iteration-->
                        <apex:variable value="{!itemPosition+1}" var="itemPosition"/>
                    </apex:repeat> <!--End of Stage Iteration-->
                </table> <!-- End of table  id="tableId" class="table tree-2 table-design" border="1" -->
            </apex:outputpanel> <!--  End of apex:outputpanel id="DetailPanel" rendered="{!(event != 'view') && (event != 'edit')}" -->

           
            <!--View and Edit Button -->
               
            <apex:pageBlock id="StgSubStgActvtySubActvtyBlck" rendered="{!((record['Type__c']=='Stage' || record['Type__c']=='Sub-stage' || record['Type__c']=='Activity' || record['Type__c']=='Sub-Activity') && (event=='view' || event=='edit'))}">
                
                <apex:outputPanel id="pageMessages1" >
                <apex:pageMessages id="pageMsg" ></apex:pageMessages>   
                </apex:outputpanel>
                
                <apex:pageBlockButtons >
                    <!--Stage / Sub-Stage View PageBlock View Buttons(Edit and Back) -->
                    <apex:outputPanel id="StageViewButtons" rendered="{!((record['Type__c']=='Stage' || record['Type__c']=='Sub-stage') && event=='view')}">
                        <div> 
                            <apex:outputPanel id="EditButOutPanelId" rendered="{!(record['Type__c']=='Stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Stage User')) || (record['Type__c']=='Sub-stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='NPD- Stage User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Sub Stage User'))}" >
                               

                     <!--    <apex:outputPanel rendered="{!IF ( OR(  AND ( OR($User.Alias=='cped',$User.Username=='duraisamy_npd@titan.co.in' ),record['Stage_name__c']=='Marketing Brief/Concept'   ), AND( $User.Username=='csaravanan_npd@titan.co.in',record['Stage_name__c']!='Marketing Brief/Concept')) , false,true)}" > -->

                               <apex:commandButton id="EditButAct" value="Edit" reRender="viewPanel,StageViewBlock" status="actStatusId" styleClass="btn-1" immediate="true"  rendered="{!if(((record['Approval_Status__c']='None' || record['Approval_Status__c']='Approved' || record['Approval_Status__c']='Re-Submit')),true,false)}">
                                    <apex:param name="eventfgdfg"  value="edit" assignTo="{!event}"/>
                                </apex:commandButton>
                                
                            <!--    </apex:outputPanel> -->
                                
                                
                            </apex:outputPanel>
                                 <!--   <apex:commandButton id="cancelButtonAct" value="Back ACT"  reRender="viewPanel,StageViewBlock"  onclick="window.location.reload()"   immediate="true" status="actStatusId" oncomplete="callTablegrid();"><apex:param name="event" value="" assignTo="{!event}"/></apex:commandButton> -->
                          <apex:commandbutton value="Back" style="background:LightBlue;width:50px;height:25px;text-align:center!important;"  action="{!getHomePage}" immediate="true"/>  
                            <apex:commandbutton value="Submit For Approval " onClick="callApprovalProcess()" rendered="{!AND(record['Approval_Required__c'],(record['Approval_Status__c']=='None' || record['Approval_Status__c']=='Re-Submit'),record['Design_Manager__c']!= NULL)}" immediate="true"  reRender="attachform"   >  
                                <apex:param name="event" value="view" assignTo="{!event}"/>
                            </apex:commandbutton>
                        </div>
                    </apex:outputPanel>
                    
                    <!--Stage / Sub-Stage Edit PageBlock Edit Buttons(Save and Cancel) -->
                    <apex:outputPanel id="StageEditButtons" rendered="{!((record['Type__c']=='Stage' || record['Type__c']=='Sub-stage') && event=='edit')}" > <!--onclick="showpopForstage('{!record['Type__c']}');"-->
                        
                        <apex:commandButton id="EditBut1" value="     Save " reRender="viewPanel,StageEditBlock" action="{!editStage}"   status="actStatusId" oncomplete="callpopupIDS('{!record['Name__c']}','{!record['Brand1__c']}')" rendered="{!if(((record['Approval_Status__c']='None' || record['Approval_Status__c']='Approved' || record['Approval_Status__c']='Re-Submit')),true,false)}">
                                    <apex:param name="eventfgdfg"  value="edit" assignTo="{!event}"/ >
                            <apex:param name="event" value="view" assignTo="{!event}"/>                        
                        </apex:commandButton>
                            <!--<apex:commandButton id="cancelButton" value="Cancel" reRender="viewPanel,StageEditBlock" immediate="true" status="actStatusId" oncomplete="callTablegrid();"><apex:param name="event" value="" assignTo="{!event}"  immediate="true"/></apex:commandButton>-->
                        <apex:commandbutton value="Cancel" action="{!getHomePage}"  reRender="viewPanel,StageEditBlock" immediate="true"  status="actStatusId" oncomplete="callTablegrid();"/>
                        <apex:commandbutton value="Submit For Approval " onClick="callApprovalProcess()" rendered="{!AND(record['Approval_Required__c'],(record['Approval_Status__c']=='None' || record['Approval_Status__c']=='Re-Submit'),record['Design_Manager__c']!= NULL)}"   reRender="viewPanel" >  
                            <apex:param name="event" value="view" assignTo="{!event}"/>
                        </apex:commandbutton>
                    </apex:outputPanel>
                    
                    <!--Activity / Sub-Activity View PageBlock View Buttons(Edit and Back) -->
                    <apex:outputPanel id="ActivityViewButtons" rendered="{!((record['Type__c']=='Activity' || record['Type__c']=='Sub-Activity') && event=='view' )}">
                        <apex:outputPanel id="EditButOutPanelActId" rendered="{!(record['Type__c']=='Activity' && ($Profile.Name=='NPD -Super User' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD Activity User')) || (record['Type__c']=='Sub-Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User'))}" >                        
                            
                         <!--    <apex:outputPanel rendered="{!IF ( OR(  AND ( OR($User.Alias=='cped',$User.Username=='duraisamy_npd@titan.co.in' ),record['Stage_name__c']=='Marketing Brief/Concept'   ), AND( $User.Username=='csaravanan_npd@titan.co.in',record['Stage_name__c']!='Marketing Brief/Concept')) , false,true)}" > -->
                            
                            <apex:commandButton id="EditBut2" value="Edit" reRender="viewPanel"  rendered="{!if(((record['Approval_Status__c']='None' || record['Approval_Status__c']='Approved' || record['Approval_Status__c']='re-submit')),true,false)}" immediate="true"   status="actStatusId" >
                                <apex:param name="event" value="edit" assignTo="{!event}"/>
                            </apex:commandButton>
                      <!--  </apex:outputPanel> -->
                        </apex:outputPanel>
                        <!-- rendered="{!if(((record['Approval_Status__c']='None' || record['Approval_Status__c']='Approved' || record['Approval_Status__c']='re-submit')),true,false)}"
                        OR(record['Approval_Status__c']='None',record['Approval_Status__c']='Approved',record['Approval_Status__c']='re-submit') -->
                            <!--<apex:commandButton id="cancelButton" value="Back" onclick="window.location.reload()" immediate="true" status="actStatusId" oncomplete="callTablegrid();" > <apex:param name="event" value="" assignTo="{!event}"/> </apex:commandButton> -->
                        <apex:commandbutton value="Back" action="{!getHomePage}" immediate="true" /> 
                        <!--  <apex:commandbutton value="Submit For Approval" onClick="callApprovalProcess()" rendered="{!AND(record['Approval_Required__c'],(record['Approval_Status__c']=='None' || record['Approval_Status__c']=='Re-Submit'),record['Actual_Start_Date__c']!= NULL)}" immediate="true"   reRender="viewPanel" >  -->
                          <apex:commandbutton value="Submit For Approval " onClick="callApprovalProcess()" rendered="{!AND(record['Approval_Required__c'],(record['Approval_Status__c']=='None' || record['Approval_Status__c']=='Line Item Pending'  || record['Approval_Status__c']==''),record['Actual_Start_Date__c']!= NULL)}" immediate="true"  reRender="viewPanel"> 
                        
                            <apex:param name="event" value="view" assignTo="{!event}"/>
                        </apex:commandbutton>
                    </apex:outputPanel>
                   
                    <!--Activity / Sub-Activity Edit PageBlock Edit Buttons(Save and Cancel) -->
                    <apex:outputPanel id="ActivityEditButtons" rendered="{!((record['Type__c']=='Activity' || record['Type__c']=='Sub-Activity') && event=='edit' )}"> 
                         
                       <!--  <apex:commandButton id="EditBut3" value="   Save  "    Onclick="callpopupIDS('{!record['Name__c']}','{!record['Brand1__c']}')" status="actStatusId"  reRender="form"   /> -->
                        
                        
                    <apex:commandButton id="EditBut3" value="   Save"    action="{!editActivity}"  rerender="viewPanel" status="actStatusId"  oncomplete="callTablegrid();">
                    <apex:param name="event" value="view" assignTo="{!event}"/>
                     </apex:commandbutton>
                         
                        
                        <!--  <apex:commandButton id="cancelButton" value="Cancel" reRender="viewPanel" immediate="true" status="actStatusId" oncomplete="callTablegrid();"><apex:param name="event" value="" assignTo="{!event}"/></apex:commandButton>-->
                        <apex:commandbutton value="Cancel" action="{!getHomePage}" immediate="true" />
                        <apex:commandbutton value="Submit For Approval" onClick="callApprovalProcess()" rendered="{!AND(record['Approval_Required__c'],(record['Approval_Status__c']=='None' || record['Approval_Status__c']=='Re-Submit'),record['Actual_Start_Date__c']!= NULL)}" immediate="true"  reRender="viewPanel"/>  
                      
                    </apex:outputPanel>
                </apex:pageBlockButtons>
                
                
                
                <!--Stage / Sub-Stage View Block -->
                
                <apex:pageBlock id="StageViewBlock" rendered="{!((record['Type__c']=='Stage' || record['Type__c']=='Sub-stage') && event=='view')}" title="{!record['Name__c']}-{!record['Type__c']}" ><!--tabStyle="NPD_Master__c" -->
                    <!--<apex:pageMessages id="pageMsg" ></apex:pageMessages>-->
                    <!--<apex:pageBlockButtons location="top">
                        <div> 
                            <apex:outputPanel id="EditButOutPanelId" rendered="{!(record['Type__c']=='Stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Stage User')) || (record['Type__c']=='Sub-stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='NPD- Stage User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Sub Stage User'))}" >
                                <apex:commandButton id="EditButAct" value="Edit" reRender="viewPanel,StageViewBlock" status="actStatusId" styleClass="btn-1" >
                                    <apex:param name="event"  value="edit" assignTo="{!event}"/>
                                </apex:commandButton>
                            </apex:outputPanel>
                                    <apex:commandButton id="cancelButtonAct" value="Back"  reRender="viewPanel,StageViewBlock"  onclick="window.location.reload()"   immediate="true" status="actStatusId" oncomplete="callTablegrid();"><apex:param name="event" value="" assignTo="{!event}"/></apex:commandButton> 
                          <!--  <apex:commandbutton value="Back" action="{!getHomePage}" immediate="true"/> - ->
                            <apex:commandbutton value="Submit For Approval " onClick="callApprovalProcess()" rendered="{!AND(record['Approval_Required__c'],(record['Approval_Status__c']=='None' || record['Approval_Status__c']=='Re-Submit'),record['Actual_Start_Date__c']!= NULL)}"  reRender="viewPanel"   >  
                                <apex:param name="event" value="view" assignTo="{!event}"/>
                            </apex:commandbutton>
                        </div>
                    </apex:pageBlockButtons>-->
                                <div class="row">
                                    <div class="date-design">
                                        <div class="heading-title">Schedule/Status Stage</div>
                  
                                        <div class="col-md-3">  
                                            <div class="form-group clearfix">
                                                <label class="col-md-6"> Planned Start Date</label>
                                                <div class="col-md-6 text"><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!record['Planned_Start_Date__c']}" /> </apex:outputText></div>                
                                            </div> 
                                        <div class="form-group clearfix">
                                            <label class="col-md-6"> Planned End Date</label>
                                            <div class="col-md-6 text"><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!record['Planned_End_Date__c']}" /> </apex:outputText></div>
                                        </div>
                                        <!-- <div class="form-group clearfix"><label class="col-md-6"> Planned Lead Time</label><div class="col-md-6 text"><apex:outputField value="{!record['Planned_Lead_Time__c']}" /> </div></div>-->
                                     <apex:outputPanel rendered="{!(record['Name__c'] == 'Marketing Brief/Concept' && record['Type__c'] == 'Stage' )}">
                                                <div class="form-group clearfix">
                                                    <label class="col-md-6">Tentative Launch Plan</label>
                                                   
                                                    <div class="col-md-6 text"> <apex:outputtext value="{0,date,MMM'/'yy}"> <apex:param value="{!record['Tentative_Launch_Plan__c']}" /> </apex:outputtext> </div>
                                                </div>
                                            </apex:outputPanel>
                                    
                                    </div>
                                    
                                    <div class="col-md-3">
                                   
                                  
                              <div class="form-group clearfix">
                                        <label class="col-md-6">Actual Start Date </label>
                                        
                                        <div class="col-md-6 text"><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!record['Actual_Start_Date__c']}" /> </apex:outputText></div>
                                    </div>
                                     
                                    <div class="form-group clearfix">
                                        <label class="col-md-6">  Actual End Date</label>
                                        
                                        <div class="col-md-6 text"><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!record['Actual_End_Date__c']}"/></apex:outputText></div>
                                    </div>
                                    
                                    <div class="form-group clearfix">
                                        <label class="col-md-6">  No of Designs</label>
                                        
                                        <div class="col-md-6 text"><apex:outputtext value="{!record['No_of_Designs__c']}"> </apex:outputText></div>
                                    </div>
                                    
                                    
                                 <!--  <div class="form-group clearfix">
                                        <label class="col-md-6"> Actual Lead Time</label>
                                        <div class="col-md-6 text"> <apex:outputField value="{!record['Actual_Lead_Time__c']}"/> </div>
                                    </div> -->
                                    </div> 
                                    
                                    
                                    <div class="col-md-3">
                                    <div class="form-group clearfix">
                                        <label class="col-md-6">  Revised Start Date</label>
                                        
                                        <div class="col-md-6 text"><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!record['Revised_Start_Date__c']}" /> </apex:outputText></div>
                                    </div>
                                    <div class="form-group clearfix">
                                        <label class="col-md-6">Revised End Date</label>
                                        
                                        <div class="col-md-6 text"><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!record['Revised_End_Date__c']}" /> </apex:outputText></div>
                                    </div>  
                                   
                                    </div>
                                    
                                    
                                    <div class="col-md-3">
                                    <div class="form-group clearfix">
                                        <label class="col-md-6"> Status</label>                  
                                        <div class="col-md-6 text"><apex:outputField value="{!record['status__c']}"/></div>
                                    </div>
                                    <div class="form-group clearfix">
                                        <label class="col-md-6">Approval Status </label>
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Approval_Status__c']}" /></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix marginbottom15"></div>
                             <div class="row">
                                    <div class="date-design design-edit">
                                        <div class="heading-title">Lead Times and Delivery Stage</div>
                                       
                                       <apex:outputPanel rendered="{!if(record['Type__c']='Sub-stage' ,true,false)}" >
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6"> Complexity Type</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Complexity_Typess__c']}" id="comType2" rendered="{!if(record['Type__c']='Sub-stage',true,false)}"></apex:outputField></div>
                                                <script>document.getElementById('{!$Component.comType2}').disabled = true;</script> 
                <!--                                <apex:image url="{!$Resource.LookupIcon}" width="20" height="20" onclick="openComplexityTypePopup('{!$Component.comType2}','{!$Component.comCat2}','{!$Component.lead2}','{!record['Name__c']}')" /> -->
                                            
                                        </div>
                                        </div>
                                         </apex:outputPanel>
                                        
                                                                    
                                        <apex:outputPanel rendered="{!if(record['Type__c']='Sub-stage' && record['Name__c'] = 'Case Development - INH',true,false)}" >
                                            <div class="col-md-3">
                                                <div class="form-group clearfix">  
                                                    <label class="col-md-6"> Complexity Category</label>
                                                    <div class="col-md-6 text"><apex:outputField value="{!record['Complexity_Category__c']}" id="comCat2" rendered="{!if(record['Type__c']='Sub-stage',true,false)}" > </apex:outputField></div>
                                                    
                                                </div>
                                            </div>
                                        </apex:outputPanel>
                                            
                                        
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6"> Planned Lead Time</label>
                                                <div class="col-md-6 text"><apex:outputField id="Lead2" value="{!record['Planned_Lead_Time__c'] }" /></div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6"> Actual Lead Time</label>
                                                <div class="col-md-6 text"><apex:outputField id="Lead1" value="{!record['Actual_Lead_Time__c'] }"/></div>
                                            </div> 
                                        </div>
                                         </div>
                                          </div>
                
                        <div class="clearfix marginbottom15"></div>
                            <div class="row">
                                <div class="date-design">
                                    <div class="heading-title">Brand And Marketing Information </div>
                                    <div class="col-md-3">
                                    <div class="form-group clearfix">
                                        <label class="col-md-6"> Brand </label>
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Brand1__c']}" /> </div>
                                    </div>
                                    </div>  
                                    
                                    <div class="col-md-3">
                                    <div class="form-group clearfix">
                                        <label class="col-md-6"> Collection reference</label>
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Collection_reference__c']}"/></div>
                                    </div>
                                    </div>
                                    
                                    <div class="col-md-3">
                                    <div class="form-group clearfix">
                                        <label class="col-md-6"> Market</label>
                                        <div class="col-md-6 text"> <apex:outputField value="{!record['Market__c']}" /> </div>
                                    </div>  
                                      </div>
                                
                                <div class="col-md-3">
                                    <div class="form-group clearfix">
                                        <label class="col-md-6">Phase </label>
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Phase__c']}"  label="Marketing Brief Concept Reference Number" /></div>
                                    </div>   
                                   </div>  
                                 
                                   
                                   
                                    <div class="col-md-3"> 
                                    <div class="form-group clearfix">
                                        <label class="col-md-6"> Sub Brand</label>
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Sub_Brand1__c']}" /></div>
                                    </div>
                                    </div>
                                    
                                 <!--  <apex:outputPanel rendered="{!if((record['Name__c']='Marketing Brief/Concept' ||record['Name__c']='Briefing' || record['Name__c']='Concept Finalization' || record['Name__c']='Concept  Briefing to ISCM' ),false,true)}" >
                                   <div class="col-md-3">  
                                    <div class="form-group clearfix">
                                        <label class="col-md-6"> Model No </label>
                                        <div class="col-md-6 text"> <apex:outputField value="{!record['Model_Name__c']}" style="width:80%;  padding-left: 20px;" rendered="{!if((record['Name__c']='Marketing Brief/Concept' ||record['Name__c']='Briefing' || record['Name__c']='Concept Finalization' || record['Name__c']='Concept  Briefing to ISCM' ),false,true)}" /></div>
                                    </div>   
                                      </div> 
                                  </apex:outputPanel> -->
                                  
                                  <div class="col-md-3">  
                                    <div class="form-group clearfix">
                                        <label class="col-md-6"> Source </label>
                                        <div class="col-md-6 text"> <apex:outputField value="{!record['Source__c']}" style="width:80%;  padding-left: 20px;"  /></div>
                                    </div>   
                                      </div> 
                                
                            <div class="col-md-3">
                                <div class="form-group clearfix">
                                    <label class="col-md-6"> MB Ref Number</label>
                                    <div class="col-md-6 text"><apex:outputField value="{!record['Marketing_brief_concept_reference_number__c']}"/></div>
                                </div>
                            </div>
                             
                               <apex:outputPanel rendered="{!if(record['Name__c']='Marketing Brief/Concept',true,false)}"  >
                              <div class="col-md-3">
                                <div class="form-group clearfix">
                                <!--    <label class="col-md-6"> Design Manager</label>
                                    <div class="col-md-6 text"><apex:outputField value="{!record['Design_Manager__c']}"/></div> -->
                            <!-- Design manager field is modified by SAI. -->                           
                                     <label class="col-md-6"> Design Manager</label>
                                    <div class="col-md-6 text"><apex:outputField value="{!record['design_manager_npd_master__c']}"/></div>
                                </div>
                            </div>
                            </apex:outputPanel>
                              </div>
                     </div>
                             <div class="clearfix marginbottom15"></div>
                                <div class="row">
                                    <div class="date-design design-edit">
                                        <div class="heading-title">Description</div>
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Comments/Remarks</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Comments_Remarks__c']}" /></div>
                                            </div>
                                        </div>
                                        
                                         
                                         <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Owner</label>
                                                <div class="col-md-6 text"><apex:outputField id="OwnerId" value="{!record['NPD_User__c']}" >
                                                <script>document.getElementById('{!$Component.ownerId}').disabled = true;</script></apex:outputField></div>
                                            </div>
                                        </div>
                                       
                                        
                                   <!--      <apex:outputPanel rendered="{!if(record['Name__c']='Marketing Brief/Concept',true,false)}"  >
                                         <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Design Manager</label>
                                                <div class="col-md-6 text"><apex:outputField id="designman" value="{!record['Design_Manager__c']}" >
                                                </apex:outputField></div>
                                            </div>
                                        </div>
                                        </apex:outputPanel>-->
                                        
                                 <!--  <apex:outputPanel rendered="{!if(record['Name__c']='Marketing Brief/Concept' ,true,false)}"  >
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Owner</label>
                                                <div class="col-md-6 text"><apex:outputField id="OwnerId1" value="{!record['ownerId']}" >
                                                <script>document.getElementById('{!$Component.ownerId1}').disabled = true;</script></apex:outputField></div>
                                            </div>
                                        </div>
                                          </apex:outputPanel> 
                                          
                                            <apex:outputPanel rendered="{!if(record['Name__c']='Marketing Brief/Concept' ||record['Name__c']='Briefing' ,true,false)}"  >
                                           <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Owner</label>
                                                <div class="col-md-6 text"><apex:outputField id="OwnerId2" value="{!record['ownerId']}" >
                                                <script>document.getElementById('{!$Component.ownerId2}').disabled = true;</script></apex:outputField></div>
                                            </div>
                                        </div>
                                         </apex:outputPanel> -->
                                        </div>
                                        </div>
                </apex:pageblock>   <!--End of StageViewBlock PageBlock-->
                
                
                <!--Stage / Sub-Stage Edit Block -->
                
                <apex:pageblock id="StageEditBlock" rendered="{!((record['Type__c']=='Stage' || record['Type__c']=='Sub-stage') && event=='edit')}" title="{!record['Name__c']}-{!record['Type__c']}">
                                
                                 
                               <div class="row">
                                    <div class="date-design">
                                        <div class="heading-title">Schedule/Status Stage</div>
                  
                                        <div class="col-md-3">  
                                            <div class="form-group clearfix">
                                                <label class="col-md-6"> Planned Start Date</label>
                                                <div class="col-md-6 text"><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!record['Planned_Start_Date__c']}" /> </apex:outputText></div>                
                                            </div> 
                                        <div class="form-group clearfix">
                                            <label class="col-md-6"> Planned End Date</label>
                                            <div class="col-md-6 text"><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!record['Planned_End_Date__c']}" /> </apex:outputText></div>
                                        </div>
                                        <!-- <div class="form-group clearfix"><label class="col-md-6"> Planned Lead Time</label><div class="col-md-6 text"><apex:outputField value="{!record['Planned_Lead_Time__c']}" /> </div></div>-->
                                     <apex:outputPanel rendered="{!(record['Name__c'] == 'Marketing Brief/Concept' && record['Type__c'] == 'Stage' )}">
                                                <div class="form-group clearfix">
                                                    <label class="col-md-6">Tentative Launch Plan</label>
                                                   
                                                    <div class="col-md-6 text"> <apex:outputtext value="{0,date,MMM'/'yy}"> <apex:param value="{!record['Tentative_Launch_Plan__c']}" /> </apex:outputtext> </div>
                                                </div>
                                            </apex:outputPanel>
                                    
                                    </div>
                                    
                                    <div class="col-md-3">
                                   
                                  
                              <div class="form-group clearfix">
                                        <label class="col-md-6">Actual Start Date </label>
                                        
                                        <div class="col-md-6 text"><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!record['Actual_Start_Date__c']}" /> </apex:outputText></div>
                                    </div>
                                     
                                    <div class="form-group clearfix">
                                        <label class="col-md-6">  Actual End Date</label>
                                        
                                        <div class="col-md-6 text"><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!record['Actual_End_Date__c']}"/></apex:outputText></div>
                                    </div>
                                    
                                
                                    <div class="form-group clearfix">
                                        <label class="col-md-6">  No of Designs</label>
                                        
                                        <div class="col-md-6 text"><apex:inputtext value="{!record['No_of_Designs__c']}"> </apex:inputtext></div>
                                    </div>                              
                                    
                                    
                                    
                                    
                                 <!--  <div class="form-group clearfix">
                                        <label class="col-md-6"> Actual Lead Time</label>
                                        <div class="col-md-6 text"> <apex:outputField value="{!record['Actual_Lead_Time__c']}"/> </div>
                                    </div> -->
                                    </div> 
                                    
                                    
                                    <div class="col-md-3">
                                    <div class="form-group clearfix">
                                        <label class="col-md-6">  Revised Start Date</label>
                                        
                                        <div class="col-md-6 text"><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!record['Revised_Start_Date__c']}" /> </apex:outputText></div>
                                    </div>
                                    <div class="form-group clearfix">
                                        <label class="col-md-6">Revised End Date</label>
                                        
                                        <div class="col-md-6 text"><apex:outputtext value="{0,date,dd'/'MMM'/'yy}"> <apex:param value="{!record['Revised_End_Date__c']}" /> </apex:outputText></div>
                                    </div>  
                                   
                                    </div>
                                    
                                    
                                    <div class="col-md-3">
                                    <div class="form-group clearfix">
                                        <label class="col-md-6"> Status</label>                  
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Revised_End_Date__c']}"/></div>
                                    </div>
                                    <div class="form-group clearfix">
                                        <label class="col-md-6">Approval Status </label>
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Approval_Status__c']}" /></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix marginbottom15"></div>
                             <div class="row">
                                    <div class="date-design design-edit">
                                        <div class="heading-title">Lead Times and Delivery Stageedit</div>
                                       
                                       <apex:outputPanel rendered="{!if(record['Type__c']='Sub-stage' ,true,false)}" >
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6"> Complexity Type</label>
                                                <div class="col-md-6 text"><apex:inputField styleClass="bordernone inputui" value="{!record['Complexity_Typess__c']}" id="comType2" rendered="{!if(record['Type__c']='Sub-stage',true,false)}">
                                                
                                            <apex:image styleClass="lookupimg"  url="{!$Resource.LookupIcon}"  width="20" height="20" onclick="openComplexityTypePopup('{!$Component.comType2}','{!$Component.comCat2}','{!$Component.lead2}','{!record['Name__c']}','{!record['Type__c']}','{!record['source__c']}')" />
                                            <script>document.getElementById('{!$Component.comType2}').disabled = true;</script>  </apex:inputField></div>
                                            
                                        </div>
                                        </div>
                                         </apex:outputPanel>
                                        
                                      <!--  <apex:outputPanel >  sudhama.... </apex:outputPanel>   -->
                                                                    
                                        <apex:outputPanel rendered="{!if(record['Type__c']='Sub-stage' && record['Name__c'] = 'Case Development - INH',true,false)}" >
                                            <div class="col-md-3">
                                                <div class="form-group clearfix">  
                                                    <label class="col-md-6"> Complexity Category</label>
                                                    <!-- <div class="col-md-6 text"><apex:inputField value="{!record['Complexity_Category__c']}" id="comCat2" rendered="{!if(record['Type__c']='Sub-stage',true,false)}" > </apex:inputField></div>  -->
                                                     <div class="col-md-6 text"><apex:inputField value="{!record['Complexity_Category__c']}" id="comCat2" rendered="{!if(record['Type__c']='Sub-stage',true,false)}" > <apex:image url="{!$Resource.LookupIcon}"  styleClass="lookupimg" width="20" height="20" onclick="openComplexityPopup('{!$Component.comType2}','{!$Component.comCat2}','{!$Component.lead2}','{!record['Name__c']}','{!record['Type__c']}')" /></apex:inputField></div>
                                                </div>
                                            </div>
                                        </apex:outputPanel>
                                            
                                        
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6"> Planned Lead Time</label>
                                                <div class="col-md-6 text"><apex:inputField id="Lead2" styleClass="inputui" value="{!record['Planned_Lead_Time__c'] }" />
                                                <script>document.getElementById('{!$Component.Lead2}').disabled = true;</script></div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6"> Actual Lead Time</label>
                                                <div class="col-md-6 text"><apex:outputField id="Lead1" value="{!record['Actual_Lead_Time__c'] }"/></div>
                                            </div> 
                                        </div>
                                         </div>
                                          </div>
                
                        <div class="clearfix marginbottom15"></div>
                            <div class="row">
                                <div class="date-design">
                                    <div class="heading-title">Brand And Marketing Informationedit </div>
                                    
                                    <apex:outputPanel rendered="{!if(record['Name__c']='Marketing Brief/Concept',false,true)}">
                                    <div class="col-md-3">
                                    <div class="form-group clearfix">
                                     <label class="col-md-6"> Brand</label>
                                                    <div class="col-md-6  text"><apex:outputField value="{!record['Brand1__c']}"  rendered="{!if(record['Name__c']='Marketing Brief/Concept',false,true)}" /> </div>
                                                </div>
                                                </div>
                                            </apex:outputPanel>
                                            
                                            <apex:outputPanel rendered="{!if(record['Name__c']='Marketing Brief/Concept',true,false)}">
                                                <div class="col-md-3">
                                                <div class="form-group clearfix">
                                                    <label class="col-md-6"> Brand</label>
                                                    <div class="col-md-6 text"><apex:inputField styleClass="bordernone inputui" value="{!record['Brand1__c']}"  id="Brand"  rendered="{!if(record['Name__c']='Marketing Brief/Concept',true,false)}" required="{!if(record['Name__c']='Marketing Brief/Concept',true,false)}"  > 
                                                     <apex:image styleClass="lookupimg" url="{!$Resource.LookupIcon}" width="20" height="20" onclick="OpenBrandPopup1('{!$Component.Brand}')"/></apex:inputField></div>
                                                </div>
                                                </div>
                                            </apex:outputPanel>
                                             
                                    
                                    <div class="col-md-3">
                                    <div class="form-group clearfix">
                                    
                                        <label class="col-md-6"> Collection reference</label>
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Collection_reference__c']}"/></div>
                                    </div>
                                    </div>
                                    
                                    <apex:outputPanel rendered="{!if(record['Name__c']='Marketing Brief/Concept',true,false)}">
                                    <div class="col-md-3">
                                                <div class="form-group clearfix">
                                                    <label class="col-md-6"> Market</label>
                                                    <div class="col-md-6 text"><apex:inputField styleClass="bordernone selectui" value="{!record['Market__c']}"  rendered="{!if(record['Name__c']='Marketing Brief/Concept',true,false)}"  required="{!if(record['Name__c']='Marketing Brief/Concept',true,false)}"  /> </div>
                                                </div>
                                                 </div>
                                            </apex:outputPanel>
                                
                                <div class="col-md-3">
                                    <div class="form-group clearfix">
                                        <label class="col-md-6">Phase </label>
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Phase__c']}"  label="Marketing Brief Concept Reference Number" /></div>
                                    </div>   
                                   </div>  
                                 
                                   
                                   
                                   <apex:outputPanel rendered="{!if(record['Name__c']='Marketing Brief/Concept',true,false)}">
                                                 <div class="col-md-3">
                                                <div class="form-group clearfix">
                                                    <label class="col-md-6">Sub-Brand</label>
                                                    <div class="col-md-6 text"><apex:inputField styleClass="inputui" value="{!record['Sub_Brand1__c']}"  id="sub1"   /> 
                                                 <apex:image styleClass="lookupimg" url="{!$Resource.LookupIcon}" width="20" height="20" onclick="OpenSubBrandPopup1('{!$Component.sub1}','{!$Component.Brand}')"/></div>
                                                </div>
                                                </div>
                                            </apex:outputPanel>
                                            <apex:outputPanel rendered="{!if(record['Name__c']='Marketing Brief/Concept',false,true)}">
                                                 <div class="col-md-3">
                                                <div class="form-group clearfix">
                                                    <label class="col-md-6">Sub-Brand</label>
                                                    <div class="col-md-6 text"><apex:outputField value="{!record['Sub_Brand1__c']}"    rendered="{!if(record['Name__c']='Marketing Brief/Concept',false,true)}" /></div>
                                                </div>
                                                </div>
                                            </apex:outputPanel>
                                    
                                    
                                    
                                    
                                    
                                    <apex:outputPanel rendered="{!if(record['Name__c']='Concept Briefing to ISCM',true,false)}">
                                                 <div class="col-md-3">
                                                <div class="form-group clearfix">
                                                    <label class="col-md-6">ISCM Briefing Date</label>
                                                    <div class="col-md-6 text"><apex:inputField styleClass="inputui" value="{!record['ISCM_Briefing_Date__c']}"    /> 
                                                 </div>
                                                </div>
                                                </div>
                                            </apex:outputPanel>  <!-- sudhama -->
                                            
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                 <!--  <apex:outputPanel rendered="{!if((record['Name__c']='Marketing Brief/Concept' ||record['Name__c']='Briefing' || record['Name__c']='Concept Finalization' || record['Name__c']='Concept  Briefing to ISCM' ),false,true)}" >
                                   <div class="col-md-3">  
                                    <div class="form-group clearfix">
                                        <label class="col-md-6"> Model No </label>
                                        <div class="col-md-6 text"> <apex:outputField value="{!record['Model_Name__c']}" style="width:80%;  padding-left: 20px;" rendered="{!if((record['Name__c']='Marketing Brief/Concept' ||record['Name__c']='Briefing' || record['Name__c']='Concept Finalization' || record['Name__c']='Concept  Briefing to ISCM' ),false,true)}" /></div>
                                    </div>   
                                      </div> 
                                  </apex:outputPanel> -->
                                  
                                 <apex:outputPanel rendered="{!if(((((record['Name__c']='Briefing' || record['Name__c']='Concept Finalization' )&& record['Type__c']='Sub-Stage') || (record['Name__c']='Marketing Brief/Concept' && record['Type__c']='Stage'))),true,false)}" >
                                                <div class="col-md-3">
                                                <div class="form-group clearfix">
                                                    <label class="col-md-6"> Source</label>
                                                    <div class="col-md-6 text"><apex:inputField styleClass="bordernone selectui" value="{!record['Source__c']}"  onchange="changevalue(this.value);"  required="{!if(record['Name__c']='Marketing Brief/Concept',true,false)}" /></div>
                                                </div>
                                                </div>
                                            </apex:outputPanel> 
                                
                                           <apex:outputPanel rendered="{!if(record['Name__c']='Marketing Brief/Concept',true,false)}" >
                                           <div class="col-md-3">
                                                <div class="form-group clearfix" >
                                                    <label class="col-md-6"> MB Ref Number</label>
                                                    <div class="col-md-6 text">
                                                    
                                                <!--    <apex:inputField styleClass="inputui" value="{!record['Marketing_brief_concept_reference_number__c']}" required="{!if(record['Name__c']='Marketing Brief/Concept',true,false)}"  />   -->
                                                
                                                <apex:outputField styleClass="inputui" value="{!record['Marketing_brief_concept_reference_number__c']}"  /> 
                                                
                                                
                                                </div>
                                                </div>
                                                </div>
                                            </apex:outputPanel>
                                            <apex:outputPanel rendered="{!if(record['Name__c']='Marketing Brief/Concept',false,true)}" >
                                            <div class="col-md-3">
                                                <div class="form-group clearfix">
                                                    <label class="col-md-6"> MB Ref Number</label>
                                                    <div class="col-md-6 text"><apex:outputField value="{!record['Marketing_brief_concept_reference_number__c']}"    label="MB Ref Number" rendered="{!if(record['Name__c']='Marketing Brief/Concept',false,true)}" /></div>
                                                </div>
                                                </div>
                                            </apex:outputPanel>
                                            
                                            
                             
                              <apex:outputPanel rendered="{!if(record['Name__c']='Marketing Brief/Concept',true,false)}"  >
                                         <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Design Manager</label>
                                             <!--   <div class="col-md-6 text"><apex:inputField id="designman" styleClass="inputui" value="{!record['Design_Manager__c']}" required="true" >
                                                </apex:inputField></div> -->
                                                
                                            <!-- Design manager modified by Sai. -->    
                                                <div class="col-md-6 text"><apex:inputField id="designman" styleClass="inputui" value="{!record['design_manager_npd_master__c']}" required="true" >
                                                </apex:inputField></div>
                                                
                                            </div>
                                        </div>
                                        </apex:outputPanel>
                              </div>
                     </div>
                             <div class="clearfix marginbottom15"></div>
                                <div class="row">
                                    <div class="date-design design-edit">
                                        <div class="heading-title">Description</div>
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Comments/Remarks</label>
                                                <div class="col-md-6 text"><apex:InputField value="{!record['Comments_Remarks__c']}" styleClass="inputui" /></div>
                                            </div>
                                        </div>
                                        
                                         
                                           <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Owner</label>
                                                <div class="col-md-6 text"><apex:inputField styleClass="inputui" id="OwnerId4" value="{!record['NPD_User__c']}" ></apex:inputField></div>
                                              <!--  <script>document.getElementById('{!$Component.ownerId4}').disabled = true;</script> -->
                                            </div>
                                        </div>
                                       
                                        
                                   <!--      <apex:outputPanel rendered="{!if(record['Name__c']='Marketing Brief/Concept',true,false)}"  >
                                         <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Design Manager</label>
                                                <div class="col-md-6 text"><apex:outputField id="designman" value="{!record['Design_Manager__c']}" >
                                                </apex:outputField></div>
                                            </div>
                                        </div>
                                        </apex:outputPanel>-->
                                        
                                 <!--  <apex:outputPanel rendered="{!if(record['Name__c']='Marketing Brief/Concept' ,true,false)}"  >
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Owner</label>
                                                <div class="col-md-6 text"><apex:outputField id="OwnerId1" value="{!record['ownerId']}" >
                                                <script>document.getElementById('{!$Component.ownerId1}').disabled = true;</script></apex:outputField></div>
                                            </div>
                                        </div>
                                          </apex:outputPanel> -->
                                          
                                            
                                        </div>
                                        </div>
                </apex:pageblock>   <!--End of StageEditBlock PageBlock-->
                
                
                
                <!--Stage / Sub-Stage View and Edit Block -->
                
                <apex:pageBlock id="StageViewEditBlock" rendered="{!((record['Type__c']=='Stage' || record['Type__c']=='Sub-stage'))}" > <!--tabStyle="NPD_Master__c" -->
                    <div class="row">
                        <apex:outputPanel style="background-color:#cae5e4;border: 1px solid #00b6b0;" layout="block">
                            <apex:pageBlockSection title="Related Task" columns="1" id="taskId"  >
                                <apex:outputPanel id="EditButOutPanelId" rendered="{!(record['Type__c']=='Stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Stage User')) || (record['Type__c']=='Sub-stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User'))}" >
                                    <apex:commandlink value="Add More"  style="color:black;" action="{!createTask}" rerender="taskId" immediate="true" />    
                                </apex:outputPanel>
                                <apex:variable value="{!0}" var="row"/>  
                                <apex:pageBlockTable value="{!taskWrapperStageList}" var="taskwrap" rendered="{!taskWrapperStageList.size>0}">
                                    <apex:column headervalue="Subject" width="15%">
                                        <apex:outputfield value="{!taskWrap.tsk.Subject}" rendered="{!NOT(taskWrap.isedit)}"/>
                                        <apex:inputtext value="{!taskWrap.tsk.Subject}" rendered="{!(taskWrap.isedit)}"/>
                                    </apex:column>     
                                    <apex:column headervalue="Status" >
                                        <apex:outputfield value="{!taskWrap.tsk.Status}" rendered="{!NOT(taskWrap.isedit)}"/>
                                        <apex:inputfield value="{!taskWrap.tsk.Status}" rendered="{!(taskWrap.isedit)}"/>
                                    </apex:column>
                                    <apex:column headervalue="Custom User / S.F User" >
                                        <apex:outputfield value="{!taskWrap.tsk.tempuser__c}" rendered="{!NOT(taskWrap.isedit)}"/> 
                                        <apex:inputfield value="{!taskWrap.tsk.tempuser__c}" id="usr" rendered="{!(taskWrap.isedit)}" required="true">
                                        <apex:image url="{!$Resource.LookupIcon}" width="20" height="20"  rendered="{!(taskWrap.isedit)}" onclick="popupforassigntask('{!$Component.usr}')"/> </apex:inputfield>
                                    </apex:column>
                                    <apex:column headervalue="Priority">
                                        <apex:outputfield value="{!taskWrap.tsk.Priority}" rendered="{!NOT(taskWrap.isedit)}"/>
                                        <apex:inputfield value="{!taskWrap.tsk.Priority}" rendered="{!(taskWrap.isedit)}"/>
                                    </apex:column>
                                    <apex:column headervalue="ActivityDate">
                                        <apex:outputfield value="{!taskWrap.tsk.ActivityDate}" rendered="{!NOT(taskWrap.isedit)}"/> 
                                        <apex:inputfield value="{!taskWrap.tsk.ActivityDate}" rendered="{!(taskWrap.isedit)}"/>
                                    </apex:column>
                                    <apex:column headervalue="Comments">
                                        <apex:outputfield value="{!taskWrap.tsk.Description}" rendered="{!NOT(taskWrap.isedit)}"/> 
                                        <apex:inputfield value="{!taskWrap.tsk.Description}" rendered="{!(taskWrap.isedit)}"/>
                                    </apex:column>
                                        <!--<apex:column headervalue="OwnerId"><apex:outputfield value="{!taskWrap.tsk.OwnerId}" rendered="{!NOT(taskWrap.isedit)}"/><apex:inputfield value="{!taskWrap.tsk.OwnerId}" rendered="{!(taskWrap.isedit)}"/></apex:column>  -->
                                        <!--<apex:column ><apex:inputtext value="{!taskWrap.tsk.OwnerId}"  rendered="{!NOT(taskWrap.isedit)}"/><apex:inputtext value="{!taskWrap.tsk.OwnerId}"   rendered="{!(taskWrap.isedit)}"/></apex:column> -->  
                                    <apex:column >
                                        <apex:outputPanel id="EditButOutPanelId" rendered="{!(record['Type__c']=='Stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Stage User')) || (record['Type__c']=='Sub-stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='NPD- Stage User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Sub Stage User'))}" >
                                            <apex:outputlabel value="Edit" onClick="editStageTask('{!row}','Task');"  style="color:blue;cursor:pointer;"  rendered="{!NOT(taskWrap.isedit)}" />
                                            <apex:outputlabel value="Save"  onclick="saveStageTask1('{!row}','Task')"  style="color:blue;cursor:pointer;"  rendered="{!(taskWrap.isedit)}" />
                                            <apex:outputtext value=" | "/>
                                            <apex:outputlabel value="Del" onClick="deleteStageTask('{!row}','Task');"  style="color:blue;cursor:pointer;" rendered="{!NOT(taskWrap.isedit)}"/>
                                            <apex:outputlabel value="X" onClick="cancelStageTask('{!row}','Task');"    style="color:blue;cursor:pointer;" rendered="{!(taskWrap.isedit)}"/>
                                        </apex:outputPanel>
                                        <apex:variable value="{!row+1}" var="row"/>
                                    </apex:column> 
                                </apex:pageBlockTable>
                                <apex:outputlabel value="There are no tasks related to this record" rendered="{!(taskWrapperStageList.size==0)}"/>    
                            </apex:pageBlockSection>
                        </apex:outputPanel>
                    </div>
                    
                    <div class="clearfix marginbottom15"></div>
                    
                    <div class="row">
                      <apex:outputPanel style="background-color:#cae5e4;border: 1px solid #00b6b0;" layout="block" rendered="{!(approvalhislist.size>0)}">
                            <apex:pageBlockSection title="Related Approval History" columns="1" id="Relatedapproval"   rendered="{!AND(record['Approval_Required__c']==true,record['Line_Item_Approval_Required__c']==false)}">
                           <!--       <apex:pageblocktable value="{!approvalhislist}" var="app" rendered="{!(approvalhislist.size>0)}">
                                    <apex:column value="{!app.Comments}" />
                                    <apex:column value="{!app.ProcessInstance.CreatedById}" />
                                    <apex:column value="{!app.ProcessInstance.CreatedDate}" />               
                                    <apex:column value="{!app.ProcessInstance.Status}" />
                                    <apex:column value="{!app.ProcessInstance.SubmittedById}" />
                                    <apex:column value="{!app.OriginalActorId}" />
                            </apex:pageblocktable>
                            <br/><br/>  -->
                             <iframe src="relatedapprovalhistoryforStage?core.apexpages.request.devconsole=1&id={!childid}" width="100%" rendered="{!Or( (approvalhislist.size>0), (record['Approval_Status__c']=='none'))}" ></iframe>

                            <apex:outputlabel value="There are no approval histroy for this record" rendered="{!(approvalhislist.size==0)}"/>    
                            </apex:pageBlockSection>
                        </apex:outputPanel>                        
                    </div>
                    
                    <div class="clearfix marginbottom15"></div>
                    
                    <div class="row">
                        <apex:outputPanel style="background-color:#cae5e4;border: 1px solid #00b6b0;" layout="block">
                            <apex:pageBlockSection title="Note" columns="1" id="notesid">
                                <apex:outputPanel id="EditButOutPanelId" rendered="{!(record['Type__c']=='Stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Stage User')) || (record['Type__c']=='Sub-stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User'))}" >
                                    <apex:commandlink value="Add Note" style="color:black;" action="{!createNote}" rerender="notesid" immediate="true" />    
                                </apex:outputPanel> 
                                <apex:variable value="{!0}" var="row"/>  
                                    <apex:pageBlockTable value="{!noteWrapperStageList}" var="notewrap" rendered="{!noteWrapperStageList.size>0}">
                                        <apex:column headervalue="Title"  >   
                                            <apex:outputfield value="{!noteWrap.nte['title']}" rendered="{!NOT(notewrap.isedit)}"/>
                                            <apex:inputfield value="{!noteWrap.nte['title']}"  rendered="{!(notewrap.isedit)}"/>
                                        </apex:column>
                                        <apex:column headervalue="Body" >
                                            <apex:outputfield value="{!noteWrap.nte['body']}" rendered="{!NOT(notewrap.isedit)}"/>
                                            <apex:inputfield value="{!noteWrap.nte ['body']}"  rendered="{!(notewrap.isedit)}"/>
                                        </apex:column>
                                        <apex:column headervalue="Related To" >
                                            <apex:outputfield value="{!record['name__c']}" />
                                        </apex:column>
                                        <apex:column >
                                            <apex:outputPanel id="EditButOutPanelId" rendered="{!(record['Type__c']=='Stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Stage User')) || (record['Type__c']=='Sub-stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User'))}" >
                                                <apex:outputlabel value="Edit" onClick="editStageTask('{!row}','Note');"  style="color:blue;cursor:pointer;"  rendered="{!NOT(notewrap.isedit)}" />
                                                <apex:outputlabel value="Save"  onclick="saveStageTask1('{!row}','Note')"  style="color:blue;cursor:pointer;"  rendered="{!(notewrap.isedit)}" />
                                               <apex:outputtext value=" | "/>
                                                <apex:outputlabel value="Del" onClick="deleteStageTask('{!row}','Note');"  style="color:blue;cursor:pointer;" rendered="{!NOT(notewrap.isedit)}"/>
                                                <apex:outputlabel value="X"   onClick="cancelStageTask('{!row}','Note');"    style="color:blue;cursor:pointer;" rendered="{!(notewrap.isedit)}"/>
                                            </apex:outputPanel>
                                            <apex:variable value="{!row+1}" var="row"/>
                                       </apex:column>
                                    </apex:pageBlockTable>
                                    <apex:outputlabel value="There are no Tasks related to this record" rendered="{!(noteWrapperStageList.size==0)}"/>    
                            </apex:pageBlockSection>
                        </apex:outputPanel>
                    </div>
                                    
                    <div class="clearfix marginbottom15"></div>
                    
                    <div class="row">
                        <apex:outputPanel style="background-color:#cae5e4;border: 1px solid #00b6b0;" layout="block">
                            <apex:pageBlockSection title="Attachment" columns="1" id="attid">
                                <apex:outputPanel id="EditButOutPanelId" rendered="{!(record['Type__c']=='Stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Stage User')) || (record['Type__c']=='Sub-stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User'))}" >
                                    <apex:commandlink value="Add Attachment" style="color:black;" action="{!createAttachment}" rerender="attachform,viewPanel,attid" status="actStatusId" immediate="true" />  <!-- rerender="attachform,viewPanel"-->  
                                </apex:outputPanel>
                                <apex:variable value="{!0}" var="row"/>  
                                <apex:pageBlockTable value="{!attWrapperStageList}" var="attwrap" rendered="{!attWrapperStageList.size>0}">
                                    <apex:column headervalue="Title"  >   
                                        <apex:outputfield value="{!attwrap.ate['name']}" rendered="{!NOT(attwrap.isedit)}"/>
                                        <apex:inputfield value="{!attwrap.ate['name']}"  rendered="{!(attwrap.isedit)}"/>
                                    </apex:column>
                                    <apex:column headervalue="Body">
                                        <apex:variable value="{!attwrap.ate['id']}" var="attachId"/>
                                        <u><apex:outputlabel value="View File" rendered="{!NOT(attwrap.isedit)}" style="cursor:pointer;" onClick="downLoadAttac('{!attachId}');"/> </u>
                                    </apex:column>
                                    <apex:column headervalue="Related To">
                                        <apex:outputfield value="{!record['name__c']}" rendered="{!NOT(attwrap.isedit)}"/>
                                    </apex:column>
                                    <apex:column headervalue="Description">
                                        <apex:outputfield value="{!attwrap.ate['Description']}" rendered="{!NOT(attwrap.isedit)}"/>
                                    </apex:column>
                                                
                                        <!--<apex:column headervalue="Body" ><apex:outputfield value="{!attwrap.ate['id']}"  rendered="{!NOT(attwrap.isedit)}"/><apex:inputfield value="{!attwrap.ate['Description']}"  rendered="{!(attwrap.isedit)}"/><u><apex:outputlabel value="View File"  rendered="{!(attwrap.isedit)}" style="cursor:pointer;" onClick="downLoadAttac('{!attachId}');"/></u></apex:column>-->
                                               
                                    <apex:column >
                                        <!--<apex:outputlabel value="Edit" onClick="editStageTask('{!row}','Attachment');"  style="color:blue;cursor:pointer;"  rendered="{!NOT(attwrap.isedit)}" /><apex:outputlabel value="Save"  onclick="saveStageTask('{!row}','Attachment')"  style="color:blue;cursor:pointer;"  rendered="{!(attwrap.isedit)}" /><apex:outputtext value=" | "/> -->
                                        <apex:outputPanel id="EditButOutPanelId" rendered="{!(record['Type__c']=='Stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Stage User')) || (record['Type__c']=='Sub-stage' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='NPD- Stage User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Sub Stage User'))}" >
                                            <apex:outputlabel value="Del" onClick="deleteStageTask('{!row}','Attachment');"  style="color:blue;cursor:pointer;" rendered="{!NOT(attwrap.isedit)}"/>
                                        </apex:outputPanel>
                                        <!--<apex:outputlabel value="X"   onClick="cancelStageTask('{!row}','Attachment');"    style="color:blue;cursor:pointer;" rendered="{!(attwrap.isedit)}"/> -->
                                        <apex:variable value="{!row+1}" var="row"/>
                                    </apex:column>
                                </apex:pageBlockTable>
                                <apex:outputlabel value="There are no tasks related to this record" rendered="{!(attWrapperStageList.size==0)}"/>    
                            </apex:pageBlockSection>
                        </apex:outputPanel>
                    </div>
                </apex:pageBlock> <!--End of  StageViewEditBlock PageBlock-->
                
                
                
                
                <!--Activity / Sub-Activity View Block -->
                
                <apex:pageblock id="ActivityViewBlock" rendered="{!((record['Type__c']=='Activity' || record['Type__c']=='Sub-Activity') && event=='view' )}" title="{!record['Name__c']}-{!record['Type__c']}">
                    
                    <apex:outputpanel rendered="{!record['approval_status__c'] == 'Pending' }"> <marquee> <font color="red" size="5" >Record is submitted for approval.  Record editing is locked now </font> </marquee>         </apex:outputPanel>   

                              
                               <div class="clearfix marginbottom15"></div>
                                <div class="row">
                                    <div class="date-design design-edit">
                                        <div class="heading-title">Schedule/Status Activity</div>
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Actual Start Date</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Actual_Start_Date__c']}" /></div>
                                            </div>
                                            
                                             <div class="form-group clearfix">
                                                <label class="col-md-6">Actual End Date</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Actual_End_Date__c']}"/>   </div>
                                            </div> 
                                            
                                            <!-- Below inserted By sai  
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">No.Of.Designs</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['No_of_Design__c']}"/>   </div>
                                            </div>    -->
                                            
                    
                                        </div>
                                        
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Status</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Status__c']}"  /> </div>
                                            </div>
                                             
                                         
                                        
                                        <div class="form-group clearfix">
                                               <label class="col-md-6">Approval Status</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Approval_Status__c']}" /></div>
                                            </div>   
                                            
                                            </div>  
                                                               
                                        <div class="col-md-3">
                                            
                                                <div class="form-group clearfix">
                                                   <label class="col-md-6">Approval Required</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Approval_Required__c']}" /> </div>
                                                </div>
                                            
                                            
                                        </div>
                                        <apex:outputPanel rendered="{!(record['Type__c'] =='Sub-Activity')}" >
                                        <div >
                                         <apex:repeat value="{!intTowrapperListforField}" var="int" id="fieldList2">
                              
                                          <apex:repeat value="{!intTowrapperListforField[int]}" var="field" id="fieldListRepea2">
                                            
                                            <div class="col-md-3">
                                            
                                            <div class="form-group clearfix">
                                                
                                                
                                                    <apex:outputPanel rendered="{!(field.isReadonly ==false)}">
                                                    
                                                    <label class="col-md-6"><apex:outputText value="{!$ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label}"></apex:outputText></label>
                                                    
                                                   <apex:outputPanel rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date',true,false)}">
                                                   <div class="col-md-6 text"><apex:outputText value="{!record[field.fieldAPI]}"  rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date',true,false)}"/> </div>
                                                   </apex:outputPanel> 
                                                   
                                                   <apex:outputPanel rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='datetime' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date',true,false)}">
                                                    <div class="col-md-6 text"><apex:outputText value="{0,date,dd'/'MMM'/'yy}"  rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='datetime' &&  $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date' ,true,false)}"> <apex:param value="{!record[field.fieldAPI]}" /></apex:outputText> </div>
                                                    </apex:outputPanel>
                                                    
                                                    <apex:outputPanel rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='date' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime',true,false)}">
                                                    <div class="col-md-6 text"><apex:outputText value="{0,date,dd'/'MMM'/'yy}"  rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='date' &&  $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime' ,true,false)}"> <apex:param value="{!record[field.fieldAPI]}" /></apex:outputText> </div>
                                                    </apex:outputPanel>
                                                    
                                                    </apex:outputPanel>
                                                    
                                                <apex:outputPanel rendered="{!(field.isReadonly == true)}">
                                                    <label class="col-md-6"><apex:outputText value="{!$ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label}"></apex:outputText></label>
                                                    <div class="col-md-6 text"><apex:outputText value="{!record[field.fieldAPI]}" /> </div>
                                                </apex:outputPanel>
                                                
                                            </div>
                                         </div>
                                        </apex:repeat>
                                        </apex:repeat>
                                       
                                    </div> 
                                      </apex:outputPanel> 
                                        
                                        <apex:outputPanel rendered="{!(record['Type__c'] =='Sub-Activity')}" >
                                            <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">No of Days Consumed </label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Number_of_Days_Consumed_c__c']}" rendered="{!(record['Type__c'] =='Sub-Activity')}" /> </div>
                                            </div> 
                                            </div> 
                                             </apex:outputPanel>
                                        
                                        
                                             
                                            
                                        
                                    </div>
                                </div>
                                
                                <div class="clearfix marginbottom15"></div>
                                <div class="row">
                                    <div class="date-design design-edit">
                                        <div class="heading-title">Brand and Market Information Activity</div>
                                        <div class="col-md-3">
                                           
                                                <div class="form-group clearfix">
                                                 <label class="col-md-6">Brand</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Brand1__c']}"/> </div>
                                                    
                                                </div>
                                           
                                            
                                            <div class="form-group clearfix">
                                            <label class="col-md-6">Sub-Brand</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Sub_Brand1__c']}"/> </div>
                                               
                                            </div>
                                          
                                            
                                       
                                        </div>
                                        
                                        
                                            
                                        
                                        <div class="col-md-3">                            
                                            <div class="form-group clearfix">
                                            <label class="col-md-6">Collection reference</label>
                                                    <div class="col-md-6 text"><apex:outputField value="{!record['Collection_reference__c']}" /></div>
                                                
                                            </div>
                                            
                                            
                                   <!--<label class="col-md-6" title="Marketing Brief Reference Number">MB Ref Number </label>
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Marketing_Brief_Reference_No__c']}"  label="Marketing Brief Concept Reference Number" /></div>-->         
                                              
                                
                                    <div class="form-group clearfix">
                                    <label class="col-md-6">Source </label>
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Source__c']}"  label="Marketing Brief Concept Reference Number" /></div>
                                        
                                      
                                   </div> 
                                            
                                          
                                            
                                                                       
                                        </div>
                                        <div class="col-md-3">                            
                                            <div class="form-group clearfix">
                                            <label class="col-md-6">Market</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Market__c']}" /> </div>
                                               
                                            </div> 
                                            
                                            
                                             <div class="form-group clearfix">
                                                <label class="col-md-6" title="Marketing Brief Reference Number">MB Ref Number </label>
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Marketing_Brief_Reference_No__c']}"  label="Marketing Brief Concept Reference Number" /></div>
                                            </div>
                                            
                                            
                                            
                                          
                                           
                                            
                                                                      
                                        </div>
                                        
                                        <div class="col-md-3">                            
                                            <div class="form-group clearfix">
                                                 <label class="col-md-6">Phase</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Phase__c']}" /></div>
                                            </div> 
                                            
                           <!--                 <div class="form-group clearfix">
                                                <label class="col-md-6">Approval Required</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Approval_Required__c']}" /> </div>
                                            </div>-->
                                            
                                            
                                           
                                          
                                            
                                                                       
                                        </div>
                                        
                                          
                                            
                          <!--                 <div class="clearfix marginbottom15"></div>
                                           <div >
                                         <apex:repeat value="{!intTowrapperListforField}" var="int" id="fieldList">
                              
                                          <apex:repeat value="{!intTowrapperListforField[int]}" var="field" id="fieldListRepeat">
                                            
                                            <div class="col-md-3">
                                            
                                            <div class="form-group clearfix">
                                                
                                                
                                                    <apex:outputPanel rendered="{!(field.isReadonly ==false)}">
                                                    
                                                    <label class="col-md-6"><apex:outputText value="{!$ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label}"></apex:outputText></label>
                                                    
                                                   <apex:outputPanel rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date',true,false)}">
                                                   <div class="col-md-6 text"><apex:outputText value="{!record[field.fieldAPI]}"  rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date',true,false)}"/> </div>
                                                   </apex:outputPanel> 
                                                   
                                                   <apex:outputPanel rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='datetime' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date',true,false)}">
                                                    <div class="col-md-6 text"><apex:outputText value="{0,date,dd'/'MMM'/'yy}"  rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='datetime' &&  $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date' ,true,false)}"> <apex:param value="{!record[field.fieldAPI]}" /></apex:outputText> </div>
                                                    </apex:outputPanel>
                                                    
                                                    <apex:outputPanel rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='date' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime',true,false)}">
                                                    <div class="col-md-6 text"><apex:outputText value="{0,date,dd'/'MMM'/'yy}"  rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='date' &&  $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime' ,true,false)}"> <apex:param value="{!record[field.fieldAPI]}" /></apex:outputText> </div>
                                                    </apex:outputPanel>
                                                    
                                                    </apex:outputPanel>
                                                    
                                                <apex:outputPanel rendered="{!(field.isReadonly == true)}">
                                                    <label class="col-md-6"><apex:outputText value="{!$ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label}"></apex:outputText></label>
                                                    <div class="col-md-6 text"><apex:outputText value="{!record[field.fieldAPI]}" /> </div>
                                                </apex:outputPanel>
                                                
                                            </div>
                                         </div>
                                        </apex:repeat>
                                        </apex:repeat>
                                       
                                    
                                </div>    -->
                                          
                                        
                                    </div>
                                </div>               
                             <div class="clearfix marginbottom15"></div>
                                <apex:outputPanel rendered="{!(record['Type__c']=='Activity')}" >
                             <div class="row">
                                    <div class="date-design design-edit">
                                        <div class="heading-title">Lead time and Delivery</div>
                                       
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6"> Complexity Type</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Complexity_Typess__c']}"  styleClass="bordernone " id="comType2" rendered="{!(record['Type__c']=='Activity')}">
                                                  </apex:outputField></div>
                                               
                                               
                                            
                                        </div>
                                        </div>
                                        
                                        
                                                                    
                                        <apex:outputPanel rendered="{!(record['Type__c']=='Activity' && record['Name__c'] = 'Case Development - INH')}">
                                            <div class="col-md-3">
                                                <div class="form-group clearfix">  
                                                    <label class="col-md-6"> Complexity Category</label>
                                                    <div class="col-md-6 text"><apex:outputField value="{!record['Complexity_Category__c'] }"  styleClass="bordernone" id="comCat2" rendered="{!(record['Type__c']=='Activity')}" > </apex:outputField></div>
                                                    <script>document.getElementById('{!$Component.comCat2}').disabled = true;</script> 
                                                    <apex:image url="{!$Resource.LookupIcon}"  styleClass="lookupimg" width="20" height="20" onclick="openComplexityPopup('{!$Component.comType2}','{!$Component.comCat2}','{!$Component.lead2}','{!record['Name__c']}','{!record['Type__c']}')" />
                                                </div>
                                            </div>
                                        </apex:outputPanel>
                                            
                                        
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6"> Planned Lead Time</label>
                                                <div class="col-md-6 text"><apex:outputField id="Lead2" value="{!record['Planned_Lead_Time__c'] }" >  
                                                 </apex:outputField></div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6"> Lead Time</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Lead_Time__c'] }"/></div>
                                            </div> 
                                        </div>
                                        
                                      
                                   
                               
                                <div class="clearfix marginbottom15"></div>
                                           <div >
                                         <apex:repeat value="{!intTowrapperListforField}" var="int" id="fieldList1">
                              
                                          <apex:repeat value="{!intTowrapperListforField[int]}" var="field" id="fieldListRepeat1">
                                            
                                            <div class="col-md-3">
                                            
                                            <div class="form-group clearfix">
                                                
                                                
                                                    <apex:outputPanel rendered="{!(field.isReadonly ==false)}">
                                                    
                                                    <label class="col-md-6"><apex:outputText title="{!$ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label}" value="{!left($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label,26)}"></apex:outputText></label>
                                                    
                                                   <apex:outputPanel rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date',true,false)}">
                                                   <div class="col-md-6 text"><apex:outputText value="{!record[field.fieldAPI]}"  rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date',true,false)}"/> </div>
                                                   </apex:outputPanel> 
                                                   
                                                   <apex:outputPanel rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='datetime' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date',true,false)}">
                                                    <div class="col-md-6 text"><apex:outputText value="{0,date,dd'/'MMM'/'yy}"  rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='datetime' &&  $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date' ,true,false)}"> <apex:param value="{!record[field.fieldAPI]}" /></apex:outputText> </div>
                                                    </apex:outputPanel>
                                                    
                                                    <apex:outputPanel rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='date' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime',true,false)}">
                                                    <div class="col-md-6 text"><apex:outputText value="{0,date,dd'/'MMM'/'yy}"  rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='date' &&  $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime' ,true,false)}"> <apex:param value="{!record[field.fieldAPI]}" /></apex:outputText> </div>
                                                    </apex:outputPanel>
                                                    
                                                    </apex:outputPanel>
                                                    
                                                <apex:outputPanel rendered="{!(field.isReadonly == true)}">
                                                    <label class="col-md-6"><apex:outputText value="{!$ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label}"></apex:outputText></label>
                                                    <div class="col-md-6 text"><apex:outputText value="{!record[field.fieldAPI]}" /> </div>
                                                </apex:outputPanel>
                                                
                                            </div>
                                         </div>
                                        </apex:repeat>
                                        </apex:repeat>
                                       
                                    </div> 
                                </div>  
                                 </div>  
                                 </apex:outputPanel>
                                  
                              <div class="clearfix marginbottom15"></div>
                                <div class="row">
                                    <div class="date-design design-edit">
                                        <div class="heading-title">Description</div>
                                        <div class="col-md-3">                            
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Comments/Remarks</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Comments_Remarks__c']}" /></div>
                                            </div>                            
                                        </div>
                                        
                                          <apex:outputPanel rendered="{!if(record['Name__c']='Briefing to IDS' ||record['Name__c']='Briefing to OSD'||record['Name__c']='Briefing to Designers'  ,true,false)}"  >
                                         <div class="col-md-3">                            
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Owner</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Ownerid']}" /></div>
                                            </div>                            
                                        </div>
                                        </apex:outputPanel>
                                        
                                         <apex:outputPanel rendered="{!if(record['Name__c']='Briefing to IDS' ||record['Name__c']='Briefing to OSD'||record['Name__c']='Briefing to Designers'  ,false,true)}"  >
                                        <div class="col-md-3">                            
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Owner</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['NPD_User__c']}" /></div>
                                            </div>                            
                                        </div>
                                         </apex:outputPanel>
                                        
                                    </div>
                                </div>
                </apex:pageblock>   <!-- End of ActivityViewBlock PageBlock-->
                
                
                
                <!--Activity / Sub-Activity Edit Block -->
                
                <apex:pageblock id="ActivityEditBlock" rendered="{!((record['Type__c']=='Activity' || record['Type__c']=='Sub-Activity') && event=='edit')}" title="{!record['Name__c']}-{!record['Type__c']}">
                               
                                
                                   <div class="clearfix marginbottom15"></div>
                                <div class="row">
                                    <div class="date-design design-edit">
                                        <div class="heading-title">Schedule/Status Activityedit</div>
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Actual Start Date</label>
                                                <div class="col-md-6 "><apex:inputField value="{!record['Actual_Start_Date__c']}"  required="true" /></div>
                                            </div>
                                            
                                             <div class="form-group clearfix">
                                                <label class="col-md-6">Actual End Date</label>
                                                <div class="col-md-6 "><apex:inputField value="{!record['Actual_End_Date__c']}"/>   </div>
                                            </div> 
                    
                                        </div>
                                        
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Status</label>
                                                <div class="col-md-6 text "><apex:inputField value="{!record['Status__c']}"  /> </div>
                                            </div>
                                             
                                         
                                        
                                        <div class="form-group clearfix">
                                               <label class="col-md-6">Approval Status</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Approval_Status__c']}" /></div>
                                            </div>   
                                            
                                            </div>  
                                                               
                                        <div class="col-md-3">
                                            
                                                <div class="form-group clearfix">
                                                   <label class="col-md-6">Approval Required</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Approval_Required__c']}" /> </div>
                                                </div>
                                            
                                            
                                        </div>
                                        <apex:outputPanel rendered="{!(record['Type__c'] =='Sub-Activity')}" >
                                        <div >
                                        <apex:repeat value="{!intTowrapperListforField}" var="int" id="fieldList">
                              
                                          <apex:repeat value="{!intTowrapperListforField[int]}" var="field" id="fieldListRepeat">
                                            
                                            <div class="col-md-3">
                                            
                                            <div class="form-group clearfix">
                                                
                                               
                                                   <apex:outputPanel rendered="{!(field.isReadonly == false)}">
                                                
                                                    <label class="col-md-6"><apex:outputText title="{!$ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label}" value="{!left($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label,10)}"></apex:outputText></label>
                                                    
                                                    <div class="col-md-6 text"><apex:inputfield value="{!record[field.fieldAPI]}" required="{!field.isMandatory}"  /> </div>
                                                    
                                                     </apex:outputPanel>
                                                
                                                <apex:outputPanel rendered="{!(field.isReadonly == true)}">
                                                    <label class="col-md-6"><apex:outputText value="{!$ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label}"></apex:outputText></label>
                                                    <div class="col-md-6 text"><apex:outputText value="{!record[field.fieldAPI]}" /> </div>
                                                </apex:outputPanel>
                                                
                                            </div>
                                         </div>
                                        </apex:repeat>
                                        </apex:repeat>
                                       
                                    </div> 
                                      </apex:outputPanel> 
                                        
                                        <apex:outputPanel rendered="{!(record['Type__c'] =='Sub-Activity')}" >
                                           <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">No of Days Consumed </label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Number_of_Days_Consumed_c__c']}" rendered="{!(record['Type__c'] =='Sub-Activity')}" /> </div>
                                            </div> 
                                            </div>
                                             </apex:outputPanel>
                                        
                                        
                                             
                                            
                                        
                                    </div>
                                </div>
                                
                                <div class="clearfix marginbottom15"></div>
                                <div class="row">
                                    <div class="date-design design-edit">
                                        <div class="heading-title">Brand and Market Information Activity</div>
                                        <div class="col-md-3">
                                           
                                                <div class="form-group clearfix">
                                                 <label class="col-md-6">Brand</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Brand1__c']}"/> </div>
                                                    
                                                </div>
                                           
                                            
                                            <div class="form-group clearfix">
                                            <label class="col-md-6">Sub-Brand</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Sub_Brand1__c']}"/> </div>
                                               
                                            </div>
                                          
                                            
                                       
                                        </div>
                                        
                                        
                                            
                                        
                                        <div class="col-md-3">                            
                                            <div class="form-group clearfix">
                                            <label class="col-md-6">Collection reference</label>
                                                    <div class="col-md-6 text"><apex:outputField value="{!record['Collection_reference__c']}" /></div>
                                                
                                            </div>
                                            
                                            
                                   <!--<label class="col-md-6" title="Marketing Brief Reference Number">MB Ref Number </label>
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Marketing_Brief_Reference_No__c']}"  label="Marketing Brief Concept Reference Number" /></div>-->         
                                              
                                
                                    <div class="form-group clearfix">
                                    <label class="col-md-6">Source </label>
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Source__c']}"  label="Marketing Brief Concept Reference Number" /></div>
                                        
                                      
                                   </div> 
                                            
                                          
                                            
                                                                       
                                        </div>
                                        <div class="col-md-3">                            
                                            <div class="form-group clearfix">
                                            <label class="col-md-6">Market</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Market__c']}" /> </div>
                                               
                                            </div> 
                                            
                                            
                                             <div class="form-group clearfix">
                                                <label class="col-md-6" title="Marketing Brief Reference Number">MB Ref Number </label>
                                        <div class="col-md-6 text"><apex:outputField value="{!record['Marketing_Brief_Reference_No__c']}"  label="Marketing Brief Concept Reference Number" /></div>
                                            </div>
                                            
                                            
                                            
                                          
                                           
                                            
                                                                      
                                        </div>
                                        
                                        <div class="col-md-3">                            
                                            <div class="form-group clearfix">
                                                 <label class="col-md-6">Phase</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Phase__c']}" /></div>
                                            </div> 
                                            
                           <!--                 <div class="form-group clearfix">
                                                <label class="col-md-6">Approval Required</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Approval_Required__c']}" /> </div>
                                            </div>-->
                                            
                                            
                                           
                                          
                                            
                                                                       
                                        </div>
                                        
                                          
                                            
                          <!--                 <div class="clearfix marginbottom15"></div>
                                           <div >
                                         <apex:repeat value="{!intTowrapperListforField}" var="int" id="fieldList">
                              
                                          <apex:repeat value="{!intTowrapperListforField[int]}" var="field" id="fieldListRepeat">
                                            
                                            <div class="col-md-3">
                                            
                                            <div class="form-group clearfix">
                                                
                                                
                                                    <apex:outputPanel rendered="{!(field.isReadonly ==false)}">
                                                    
                                                    <label class="col-md-6"><apex:outputText value="{!$ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label}"></apex:outputText></label>
                                                    
                                                   <apex:outputPanel rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date',true,false)}">
                                                   <div class="col-md-6 text"><apex:outputText value="{!record[field.fieldAPI]}"  rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date',true,false)}"/> </div>
                                                   </apex:outputPanel> 
                                                   
                                                   <apex:outputPanel rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='datetime' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date',true,false)}">
                                                    <div class="col-md-6 text"><apex:outputText value="{0,date,dd'/'MMM'/'yy}"  rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='datetime' &&  $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='date' ,true,false)}"> <apex:param value="{!record[field.fieldAPI]}" /></apex:outputText> </div>
                                                    </apex:outputPanel>
                                                    
                                                    <apex:outputPanel rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='date' && $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime',true,false)}">
                                                    <div class="col-md-6 text"><apex:outputText value="{0,date,dd'/'MMM'/'yy}"  rendered="{!if($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type=='date' &&  $ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Type!='datetime' ,true,false)}"> <apex:param value="{!record[field.fieldAPI]}" /></apex:outputText> </div>
                                                    </apex:outputPanel>
                                                    
                                                    </apex:outputPanel>
                                                    
                                                <apex:outputPanel rendered="{!(field.isReadonly == true)}">
                                                    <label class="col-md-6"><apex:outputText value="{!$ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label}"></apex:outputText></label>
                                                    <div class="col-md-6 text"><apex:outputText value="{!record[field.fieldAPI]}" /> </div>
                                                </apex:outputPanel>
                                                
                                            </div>
                                         </div>
                                        </apex:repeat>
                                        </apex:repeat>
                                       
                                    
                                </div>    -->
                                          
                                        
                                    </div>
                                </div>               
                             <div class="clearfix marginbottom15"></div>
                                <apex:outputPanel rendered="{!(record['Type__c']=='Activity')}" >
                             <div class="row">
                                    <div class="date-design design-edit">
                                        <div class="heading-title">Lead time and Delivery</div>
                                       
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6"> Complexity Type</label>
                                                <div class="col-md-6 text"><apex:inputField styleClass="bordernone inputui" value="{!record['Complexity_Typess__c']}" id="comType2" rendered="{!(record['Type__c']=='Activity')}">
                                                 <apex:image url="{!$Resource.LookupIcon}" styleClass="lookupimg"  width="20" height="20" onclick="openComplexityTypePopup('{!$Component.comType2}','{!$Component.comCat2}','{!$Component.lead2}','{!record['Name__c']}','{!record['Type__c']}','{!record['source__c']}')" /> </apex:inputField></div>
                                                <script>document.getElementById('{!$Component.comType2}').disabled = true;</script> 
                                               
                                               
                                            
                                        </div>
                                        </div>
                                        
                                        
                                                                    
                                   <!--      <apex:outputPanel rendered="{!(record['Type__c']=='Activity' && record['Name__c'] = 'Case Development - INH')}"> -->
                                   
                                   <apex:outputPanel rendered="{!(record['Type__c']=='Activity' && contains(record['SerialNo__c'],'AR-0302'))}">  
                                   
                                            <div class="col-md-3">
                                                <div class="form-group clearfix">  
                                              <!--      <label class="col-md-6"> Complexity Category</label>
                                                    <div class="col-md-6 text"><apex:inputField styleClass="bordernone inputui" value="{!record['Complexity_Category__c'] }" id="comCat2" rendered="{!(record['Type__c']=='Activity')}" > </apex:inputField></div>
                                                    <script>document.getElementById('{!$Component.comCat2}').disabled = true;</script> 
                                                    <apex:image url="{!$Resource.LookupIcon}"  styleClass="lookupimg" width="20" height="20" onclick="openComplexityPopup('{!$Component.comType2}','{!$Component.comCat2}','{!$Component.lead2}','{!record['Name__c']}','{!record['Type__c']}')" />   -->
                                                    
                                                    
                                                <label class="col-md-6"> Complexity Category</label>
                                                    <div class="col-md-6 text"><apex:inputField styleClass="bordernone inputui" value="{!record['Complexity_Category__c'] }" id="comCat2" rendered="{!(record['Type__c']=='Activity')}" >
                                                    <apex:image url="{!$Resource.LookupIcon}"  styleClass="lookupimg" width="20" height="20" onclick="openComplexityPopup('{!$Component.comType2}','{!$Component.comCat2}','{!$Component.lead2}','{!record['Name__c']}','{!record['Type__c']}')" />
                                                    
                                                    </apex:inputField></div>
                                                    <script>document.getElementById('{!$Component.comCat2}').disabled = true;</script>      
                                                    
                                                    
                                                    
                                                    
                                                </div>
                                            </div>
                                        </apex:outputPanel>
                                            
                                        
                                       <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6"> Planned Lead Time</label>
                                                <div class="col-md-6 text"><apex:inputField styleClass="bordernone inputui" id="Lead2" value="{!record['Planned_Lead_Time__c'] }" >  
                                                <script>document.getElementById('{!$Component.Lead2}').disabled = true;</script> </apex:inputField></div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-3">
                                            <div class="form-group clearfix">
                                                <label class="col-md-6"> Lead Time</label>
                                                <div class="col-md-6 text"><apex:outputField value="{!record['Lead_Time__c'] }"/></div>
                                            </div> 
                                        </div>
                                        
                                      
                                   
                               
                                <div class="clearfix marginbottom15"></div>
                                           <div >
                                         <apex:repeat value="{!intTowrapperListforField}" var="int" id="fieldList1">
                              
                                          <apex:repeat value="{!intTowrapperListforField[int]}" var="field" id="fieldList1Repeat">
                                            
                                            <div class="col-md-3">
                                            
                                            <div class="form-group clearfix">
                                                
                                               
                                                   <apex:outputPanel rendered="{!(field.isReadonly == false)}">
                                                
                                                    <label class="col-md-6"><apex:outputText title="{!$ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label}" value="{!left($ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label,21)}"></apex:outputText></label>
                                                    
                                                    <div class="col-md-6 text"><apex:inputfield value="{!record[field.fieldAPI]}" required="{!field.isMandatory}"  /> </div>
                                                    
                                                     </apex:outputPanel>
                                                
                                                <apex:outputPanel rendered="{!(field.isReadonly == true)}">
                                                    <label class="col-md-6"><apex:outputText value="{!$ObjectType.NPD_Activity__c.Fields[field.fieldAPI].Label}"></apex:outputText></label>
                                                    <div class="col-md-6 text"><apex:outputText value="{!record[field.fieldAPI]}" /> </div>
                                                </apex:outputPanel>
                                                
                                            </div>
                                         </div>
                                        </apex:repeat>
                                        </apex:repeat>
                                       
                                    </div> 
                                </div>  
                                 </div>  
                                 </apex:outputPanel>
                                  
                              <div class="clearfix marginbottom15"></div>
                                <div class="row">
                                    <div class="date-design design-edit">
                                        <div class="heading-title">Description</div>
                                        <div class="col-md-3">                            
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Comments/Remarks</label>
                                                <div class="col-md-6 text"><apex:inputField value="{!record['Comments_Remarks__c']}" /></div>
                                            </div>                            
                                        </div>
                                        
                                          <apex:outputPanel rendered="{!if(record['Name__c']='Briefing to IDS' ||record['Name__c']='Briefing to OSD'||record['Name__c']='Briefing to Designers'  ,true,false)}"  >
                                         <div class="col-md-3">                            
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Owner</label>
                                                <div class="col-md-6 text"><apex:InputField value="{!record['Ownerid']}" /></div>
                                            </div>                            
                                        </div>
                                        </apex:outputPanel>
                                        
                                        <apex:outputPanel rendered="{!if(record['Name__c']='Briefing to IDS' ||record['Name__c']='Briefing to OSD'||record['Name__c']='Briefing to Designers'  ,false,true)}"  >
                                        <div class="col-md-3">                            
                                            <div class="form-group clearfix">
                                                <label class="col-md-6">Owner</label>
                                                <div class="col-md-6 text"><apex:inputField value="{!record['NPD_User__c']}" /></div>
                                            </div>                            
                                        </div>
                                        </apex:outputPanel>
                                        
                                    </div>
                                </div>
                                  
                                        
                                
                </apex:pageblock> <!--End of -ActivityEditBlock PageBlock-->

                
                
                
                <!--Activity / Sub-Activity View and Edit Block -->
                <apex:actionregion >
                <apex:actionFunction name="saveStageAction"  action="{!saveIndividualTask}" id="saveactionid" rerender="viewPanel"  oncomplete="showerrordynamictable('{!strErrorMsg}');" status="actStatusId" > 
                
                
                  <apex:param value="" name="rowNum" assignto="{!rowNum}"/>
                    <apex:param value="" name="relatedListType" assignTo="{!relatedListType}"/>
               </apex:actionFunction> 
               
               
                
                <apex:pageBlock id="ActivityViewEditBlock" rendered="{!((record['Type__c']=='Activity' || record['Type__c']=='Sub-Activity')) }" >
                    <div class="row">
                        <apex:outputPanel style="background-color:#cae5e4;border: 1px solid #00b6b0;" layout="block">
                            <apex:pageblocksection title="Dynamic Table" columns="1" id="CheckId"   onKeyPress="return disableEnterKey(event)">
                                <div class="errormsgId"></div>
                                    <apex:outputPanel id="EditButOutPanelActId" rendered="{!(record['Type__c']=='Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User')) || (record['Type__c']=='Sub-Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User'))}" >
                                        <apex:commandLink value="Add More" action="{!createCheckList}" style="color:blue;" rerender="CheckId" immediate="true" />
                                    </apex:outputPanel>
                                    <apex:variable value="{!0}" var="row1"/>
                                    <apex:pageBlockTable value="{!dynamicSobjWrapperMap['NPD_Checklist__c']}" var="wrapCheck" rendered="{!IsCheckLists}" >
                                        <apex:repeat value="{!DisplayFieldsList}" var="key">
                                          
                                  <!--  commented by Sai. Psy need to be edit from front end 
                                          <apex:column headerValue="{!$ObjectType.NPD_Checklist__c.Fields[key].Label}">
                                                <apex:outputField value="{!wrapCheck.sobj[key]}" rendered="{!(NOT(wrapCheck.isedit) || $ObjectType.NPD_Checklist__c.Fields[key].Label == 'PSY No' || $ObjectType.NPD_Checklist__c.Fields[key].Label == 'Design No'   || $ObjectType.NPD_Checklist__c.Fields[key].Label == 'Approval Status')}"/>
                                               <apex:inputfield value="{!wrapCheck.sobj[key]}" rendered="{!((wrapCheck.isedit) && ($ObjectType.NPD_Checklist__c.Fields[key].Label != 'PSY No' && $ObjectType.NPD_Checklist__c.Fields[key].Label != 'Design No'  && $ObjectType.NPD_Checklist__c.Fields[key].Label != 'Approval Status'))}"/>
                                            </apex:column>
                                            
                                    -->     
                                            
                                            <apex:column headerValue="{!$ObjectType.NPD_Checklist__c.Fields[key].Label}">
                                                <apex:outputField value="{!wrapCheck.sobj[key]}" rendered="{!(NOT(wrapCheck.isedit) || $ObjectType.NPD_Checklist__c.Fields[key].Label == 'Design No'   || $ObjectType.NPD_Checklist__c.Fields[key].Label == 'Approval Status')}"/>
                                               <apex:inputfield value="{!wrapCheck.sobj[key]}" rendered="{!((wrapCheck.isedit) && ($ObjectType.NPD_Checklist__c.Fields[key].Label != 'Design No'  && $ObjectType.NPD_Checklist__c.Fields[key].Label != 'Approval Status'))}"/>
                                            </apex:column>
                                            
                                        </apex:repeat>
                                            
                                        <!--<apex:column headervalue="Approval Staus History"><apex:commandlink value="View History" style="color:blue;" action="{!lineitemapprovalhistory}" rerender="popUp"><apex:param name="checkId1" value="{!sobj['id']}" assignTo="{!checkId1}"/></apex:commandlink></apex:column>  --> 
                                        <apex:column ></apex:column>
                                        <apex:column headervalue="Action">
                                           
                                         
                                           <apex:outputPanel id="EditButOutPanelActId" rendered="{!(record['Type__c']=='Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User')) || (record['Type__c']=='Sub-Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User'))}" >
                                                <u>  <apex:outputlabel value="Edit" onClick="editStageTask('{!row1}','NPD_Checklist__c');"  style="color:blue;cursor:pointer;"  rendered="{!NOT(wrapCheck.isedit)}" /></u>
                                                <u>  <apex:outputlabel value="Save"  onclick="saveStageTask('{!row1}','NPD_Checklist__c');"  style="color:blue;cursor:pointer;"  rendered="{!(wrapCheck.isedit)}" />
                                                </u><apex:outputtext value=" | "/>
                                                <u><apex:outputlabel value="Del" onClick="deleteStageTask('{!row1}','NPD_Checklist__c');"  style="color:blue;cursor:pointer;"  rendered="{!NOT(wrapCheck.isedit)}"/>
                                                </u>
                                                
                                                <!-- <u> <apex:outputlabel value="X" onClick="cancelStageTask('{!row1}','NPD_Checklist__c');"  style="color:blue;cursor:pointer;" rendered="{!(wrapCheck.isedit)}"/></u>  -->
                                                
                                                
                                                <u> <apex:outputlabel value="Del" onClick="cancelStageTask('{!row1}','NPD_Checklist__c');"  style="color:blue;cursor:pointer;" rendered="{!(wrapCheck.isedit)}"/></u>
                                                
                                                    <!--</u> <apex:outputtext value=" | " rendered="{!AND(SubmitCheckVisible,NOT(wrapCheck.isedit),(OR(ISBLANK(wrapCheck.sobj['Approval_Status__c']),wrapCheck.sobj['Approval_Status__c']=='None') ))}"/> <b> <apex:commandLink value="Submit for Approval" Action="{!submitChecklist}" style="color:blue;cursor:pointer;" rerender="CheckId" rendered="{!AND(SubmitCheckVisible,NOT(wrapCheck.isedit),(OR(ISBLANK(wrapCheck.sobj['Approval_Status__c']),wrapCheck.sobj['Approval_Status__c']=='None') ))}"><apex:param value="{!row1}" assignto="{!rowNum}" name="rowNum" /></apex:commandLink>  </b> -->
                                            </apex:outputPanel>
                                                 
                                            <apex:outputlabel value="| Approval History" onClick="viewhistory('{!row1}','NPD_Checklist__c');"  style="color:blue;cursor:pointer;"   rendered="{!AND(NOT(wrapCheck.isedit),record['Line_Item_Approval_Required__c']==true)}"   />  
                                            <apex:variable value="{!row1+1}" var="row1"/> 
                                        </apex:column>
                                    </apex:pageBlockTable>
                            </apex:pageblocksection> 
                        </apex:outputpanel>  
                    </div>
                
                    <div class="row">
                        <apex:outputPanel style="background-color:#cae5e4;border: 1px solid #00b6b0;" layout="block">
                            <apex:pageBlockSection title="Related Task" columns="1" id="taskId">
                                <apex:outputPanel id="EditButOutPanelActId" rendered="{!(record['Type__c']=='Activity' && ($Profile.Name=='NPD -Super User' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User')) || (record['Type__c']=='Sub-Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User'))}" >
                                    <apex:commandlink value="Add More" style="color:blue;" action="{!createTask}" rerender="taskId" immediate="true" />
                                </apex:outputPanel>    
                                <apex:variable value="{!0}" var="row"/>  
                                <apex:pageBlockTable value="{!taskWrapperStageList}" var="taskwrap" rendered="{!taskWrapperStageList.size>0}">
                                    <apex:column headervalue="Subject" width="15%">
                                        <apex:outputfield value="{!taskWrap.tsk.Subject}" rendered="{!NOT(taskWrap.isedit)}"/>
                                        <apex:inputtext value="{!taskWrap.tsk.Subject}" rendered="{!(taskWrap.isedit)}"/>
                                    </apex:column>     
                                    <apex:column headervalue="Status" >
                                        <apex:outputfield value="{!taskWrap.tsk.Status}" rendered="{!NOT(taskWrap.isedit)}"/>
                                        <apex:inputfield value="{!taskWrap.tsk.Status}" rendered="{!(taskWrap.isedit)}"/>
                                    </apex:column>
                                    <apex:column headervalue="Custom User / S.F User" >
                                        <apex:outputfield value="{!taskWrap.tsk.tempuser__c}" rendered="{!NOT(taskWrap.isedit)}"/> 
                                        <apex:inputfield value="{!taskWrap.tsk.tempuser__c}" id="usr"  required="true" rendered="{!(taskWrap.isedit)}">
                                        <apex:image url="{!$Resource.LookupIcon}" width="20" height="20"  rendered="{!(taskWrap.isedit)}" onclick="popupforassigntask('{!$Component.usr}')"/> </apex:inputfield>
                                    </apex:column>
                                    <apex:column headervalue="Priority">
                                        <apex:outputfield value="{!taskWrap.tsk.Priority}" rendered="{!NOT(taskWrap.isedit)}"/>
                                        <apex:inputfield value="{!taskWrap.tsk.Priority}" rendered="{!(taskWrap.isedit)}"/>
                                    </apex:column>
                                              
                                        <!--<apex:column headervalue="OwnerId"> <apex:outputfield value="{!taskWrap.tsk.OwnerId}" rendered="{!NOT(taskWrap.isedit)}"/> <apex:inputfield value="{!taskWrap.tsk.OwnerId}" rendered="{!(taskWrap.isedit)}"/></apex:column>  -->
                                               
                                    <apex:column headervalue="ActivityDate">
                                        <apex:outputfield value="{!taskWrap.tsk.ActivityDate}" rendered="{!NOT(taskWrap.isedit)}"/> 
                                        <apex:inputfield value="{!taskWrap.tsk.ActivityDate}" rendered="{!(taskWrap.isedit)}"/>
                                    </apex:column>
                                    <apex:column headervalue="Comments">
                                        <apex:outputfield value="{!taskWrap.tsk.Description}" rendered="{!NOT(taskWrap.isedit)}"/> 
                                        <apex:inputfield value="{!taskWrap.tsk.Description}" rendered="{!(taskWrap.isedit)}"/>
                                    </apex:column>
                                               
                                        <!--<apex:column ><apex:inputtext value="{!taskWrap.tsk.OwnerId}"  rendered="{!NOT(taskWrap.isedit)}"/><apex:inputtext value="{!taskWrap.tsk.OwnerId}"   rendered="{!(taskWrap.isedit)}"/></apex:column> -->  
                                               
                                    <apex:column >
                                        <apex:outputPanel id="EditButOutPanelActId" rendered="{!(record['Type__c']=='Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User')) || (record['Type__c']=='Sub-Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User'))}" >
                                            <apex:outputlabel value="Edit" onClick="editStageTask('{!row}','Task');"  style="color:blue;cursor:pointer;"  rendered="{!NOT(taskWrap.isedit)}" />
                                            <apex:outputlabel value="Save"  onclick="saveStageTask('{!row}','Task')"  style="color:blue;cursor:pointer;"  rendered="{!(taskWrap.isedit)}" />
                                            <apex:outputtext value=" | "/>
                                            <apex:outputlabel value="Del" onClick="deleteStageTask('{!row}','Task');"  style="color:blue;cursor:pointer;" rendered="{!NOT(taskWrap.isedit)}"/>
                                            <apex:outputlabel value="X" onClick="cancelStageTask('{!row}','Task');"    style="color:blue;cursor:pointer;" rendered="{!(taskWrap.isedit)}"/>
                                        </apex:outputPanel>
                                        <apex:variable value="{!row+1}" var="row"/>
                                    </apex:column> 
                                </apex:pageBlockTable>
                                <apex:outputlabel value="There are no tasks related to this record" rendered="{!(taskWrapperStageList.size==0)}"/>    
                            </apex:pageBlockSection>
                        </apex:outputpanel>
                    </div>
                
                    <div class="row">
                        <apex:outputPanel style="background-color:#cae5e4;border: 1px solid #00b6b0;" layout="block">
                            <apex:pageBlockSection title="Related Approval History" columns="1" id="Relatedapproval"   rendered="{!AND(record['Approval_Required__c']==true,record['Line_Item_Approval_Required__c']==false)}">
                              <!--  <apex:pageblocktable value="{!approvalhislist}" var="app" rendered="{!(approvalhislist.size>0)}">
                                    <apex:column value="{!app.Comments}" />
                                    <apex:column value="{!app.ProcessInstance.CreatedById}" />
                                    <apex:column value="{!app.ProcessInstance.CreatedDate}" />               
                                    <apex:column value="{!app.ProcessInstance.Status}" />
                                    <apex:column value="{!app.ProcessInstance.SubmittedById}" />
                                    <apex:column value="{!app.OriginalActorId}" />
                            </apex:pageblocktable>
                            <br/><br/>   -->
                            
                             <iframe src="relatedapprovalhistory?core.apexpages.request.devconsole=1&id={!childid}" width="100%" rendered="{!Or( (approvalhislist.size>0), (record['Approval_Status__c']=='none'))}" ></iframe>
                            
                            <apex:outputlabel value="There are no approval histroy for this record" rendered="{!(approvalhislist.size==0)}"/>    
                            </apex:pageBlockSection>
                        </apex:outputPanel>                        
                    </div>
    
                
                    <div class="clearfix marginbottom15"></div>
                    
                    <div class="clearfix marginbottom15"></div>
                               
                    <div class="row">
                        <apex:outputPanel style="background-color:#cae5e4;border: 1px solid #00b6b0;" layout="block"> 
                            <apex:pageBlockSection title="Note" columns="1" id="notesid">
                                <apex:outputPanel id="EditButOutPanelActId" rendered="{!(record['Type__c']=='Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User')) || (record['Type__c']=='Sub-Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User'))}" >
                                    <apex:commandlink value="Add Note" style="color:blue;" action="{!createNote}" rerender="notesid" immediate="true"/>    
                                </apex:outputPanel>
                                <apex:variable value="{!0}" var="row"/>  
                                <apex:pageBlockTable value="{!noteWrapperStageList}" var="notewrap" rendered="{!noteWrapperStageList.size>0}">
                                    <apex:column headervalue="Title"  >   
                                        <apex:outputfield value="{!noteWrap.nte['title']}" rendered="{!NOT(notewrap.isedit)}"/>
                                        <apex:inputfield value="{!noteWrap.nte['title']}"  rendered="{!(notewrap.isedit)}"/>
                                    </apex:column>
                                    <apex:column headervalue="Body" >
                                        <apex:outputfield value="{!noteWrap.nte['body']}" rendered="{!NOT(notewrap.isedit)}"/>
                                        <apex:inputfield value="{!noteWrap.nte ['body']}"  rendered="{!(notewrap.isedit)}"/>
                                    </apex:column>
                                    <apex:column headervalue="Related To" >
                                        <apex:outputfield value="{!record['name__c']}" />
                                    </apex:column>
                                    <apex:column >
                                        <apex:outputPanel id="EditButOutPanelActId" rendered="{!(record['Type__c']=='Activity' && ($Profile.Name=='NPD -Super User' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='System Administrator' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User')) || (record['Type__c']=='Sub-Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User'))}" >
                                            <apex:outputlabel value="Edit" onClick="editStageTask('{!row}','Note');"  style="color:blue;cursor:pointer;"  rendered="{!NOT(notewrap.isedit)}" />
                                            <apex:outputlabel value="Save"  onclick="saveStageTask('{!row}','Note')"  style="color:blue;cursor:pointer;"  rendered="{!(notewrap.isedit)}" />
                                            <apex:outputtext value=" | "/>
                                            <apex:outputlabel value="Del" onClick="deleteStageTask('{!row}','Note');"  style="color:blue;cursor:pointer;" rendered="{!NOT(notewrap.isedit)}"/>
                                            <apex:outputlabel value="Del"   onClick="cancelStageTask('{!row}','Note');"    style="color:blue;cursor:pointer;" rendered="{!(notewrap.isedit)}"/>
                                        </apex:outputPanel>
                                        <apex:variable value="{!row+1}" var="row"/>
                                    </apex:column>
                                </apex:pageBlockTable>
                                <apex:outputlabel value="There are no Notes related to this record" rendered="{!(noteWrapperStageList.size==0)}"/>    
                            </apex:pageBlockSection>
                        </apex:OutputPanel>
                    </div>
                
                    <div class="clearfix marginbottom15"></div>
                
                    <div class="row">
                        <apex:outputPanel style="background-color:#cae5e4;border: 1px solid #00b6b0;" layout="block">
                            <apex:pageBlockSection title="Attachment" columns="1" id="attid">
                                <apex:outputPanel id="EditButOutPanelActId" rendered="{!(record['Type__c']=='Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User')) || (record['Type__c']=='Sub-Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User'))}" >
                                    <apex:commandlink value="Add Attachment" style="color:blue;"  rerender="attachform,viewPanel,attid" action="{!createAttachment}"  immediate="true"/>  <!-- rerender="attachform,viewPanel,attid"  -->
                                </apex:outputPanel>
                                <apex:variable value="{!0}" var="row"/>  
                                <apex:pageBlockTable value="{!attWrapperStageList}" var="attwrap" rendered="{!attWrapperStageList.size>0}">
                                    <apex:column headervalue="Title"  >   
                                        <apex:outputfield value="{!attwrap.ate['name']}" rendered="{!NOT(attwrap.isedit)}"/>
                                        <apex:inputfield value="{!attwrap.ate['name']}"  rendered="{!(attwrap.isedit)}"/>
                                    </apex:column>
                                    <apex:column headervalue="Body">
                                        <apex:variable value="{!attwrap.ate['id']}" var="attachId"/>
                                        <u><apex:outputlabel value="View File" rendered="{!NOT(attwrap.isedit)}" style="cursor:pointer;" onClick="downLoadAttac('{!attachId}');"/> </u>
                                    </apex:column>
                                    <apex:column headervalue="Related To">
                                        <apex:outputfield value="{!record['name__c']}" rendered="{!NOT(attwrap.isedit)}"/>
                                    </apex:column>
                                    <apex:column headervalue="Description">
                                        <apex:outputfield value="{!attwrap.ate['Description']}" rendered="{!NOT(attwrap.isedit)}"/>
                                    </apex:column>
                                                
                                        <!--<apex:column headervalue="Body" ><apex:outputfield value="{!attwrap.ate['id']}"  rendered="{!NOT(attwrap.isedit)}"/><apex:inputfield value="{!attwrap.ate['Description']}"  rendered="{!(attwrap.isedit)}"/><u><apex:outputlabel value="View File"  rendered="{!(attwrap.isedit)}" style="cursor:pointer;" onClick="downLoadAttac('{!attachId}');"/></u></apex:column>-->
                                               
                                    <apex:column >
                                        <!--<apex:outputlabel value="Edit" onClick="editStageTask('{!row}','Attachment');"  style="color:blue;cursor:pointer;"  rendered="{!NOT(attwrap.isedit)}" /><apex:outputlabel value="Save"  onclick="saveStageTask('{!row}','Attachment')"  style="color:blue;cursor:pointer;"  rendered="{!(attwrap.isedit)}" /><apex:outputtext value=" | "/> -->
                                        <apex:outputPanel id="EditButOutPanelActId" rendered="{!(record['Type__c']=='Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User')) || (record['Type__c']=='Sub-Activity' && ($Profile.Name=='NPD -Super User' || $Profile.Name=='System Administrator' ||$Profile.Name=='NPD- Stage User' || $Profile.Name=='NPD- Sub Stage User' ||$Profile.Name=='NPD Activity User'))}" >
                                            <apex:outputlabel value="Del" onClick="deleteStageTask('{!row}','Attachment');"  style="color:blue;cursor:pointer;" rendered="{!NOT(attwrap.isedit)}"/>
                                        </apex:outputPanel>
                                        <!--<apex:outputlabel value="X"   onClick="cancelStageTask('{!row}','Attachment');"    style="color:blue;cursor:pointer;" rendered="{!(attwrap.isedit)}"/> -->
                                        <apex:variable value="{!row+1}" var="row"/>
                                    </apex:column>
                                </apex:pageBlockTable>
                                <apex:outputlabel value="There are no Attachments related to this record" rendered="{!(attWrapperStageList.size==0)}"/>    
                            </apex:pageBlockSection>
                        </apex:outputpanel>
                    </div>
                </apex:pageBlock>   <!-- End of ActivityViewEditBlock PageBlock-->
             </apex:actionregion>
             
            </apex:pageBlock>   <!--End of StgSubStgActvtySubActvtyBlck PageBlock-->



            <!-- End of Edit and View button -->

                  
                   
                        
                    <apex:outputPanel id="popInnerOutputPnl" styleClass="popupBackground"  rendered="{!displayPopUp1}" >
                    <div class="customPopup">
                    <apex:pageblock >
                       <apex:commandButton value="X" title="Close the popup"   id="butt" styleClass="closeButton" rerender="viewPanel">
                           <apex:param name="displayPopup1" value="false" assignTo="{!displayPopUp1}"/>
                         </apex:commandButton>
                        <center><div style="font-size:18px;">   Line Item Approval History </div></center>
                        
                            <apex:pageblocktable value="{!appHistoryWraplist}" var="apphistwrap"  rendered="{!appHistoryWraplist.size>0}">
                           
                            <apex:column headerValue="Date"  value="{!apphistwrap.cdate}" />
                            <apex:column headerValue="Related User"   value="{!apphistwrap.username}" />
                            <apex:column headerValue="Action"  value="{!apphistwrap.action}"  />
                            
                            </apex:pageblocktable>
                 
             
                    <apex:outputtext rendered="{!NOT(ISBLANK(nolinehistory))}" >   {!nolinehistory}  </apex:outputtext>
                            
                         </apex:pageblock>
                      </div>    
                    </apex:outputPanel>
              
                   
                  
                  
              </apex:outputpanel>
              
            <apex:actionFunction name="mapEditvalueAf" action="{!EditRecord}" reRender="viewPanel" status="actStatusId">
                <apex:param value="" name="recId" assignto="{!childId}"/>            
                <apex:param value="" name="event" assignto="{!event}"/>            
            </apex:actionFunction>
           
           
             <!--   <apex:actionFunction name="saveStageAction"  action="{!saveIndividualTask}" id="saveactionid" rerender="viewPanel"  oncomplete="showerrordynamictable('{!strErrorMsg}');" status="actStatusId" >   --> 
               
               <apex:actionFunction name="saveStageAction2"  action="{!saveIndividualTask}" id="saveactionid" rerender="viewPanel"  oncomplete="showerrordynamictable('{!strErrorMsg}');" status="actStatusId" >
               
               
                    <apex:param value="" name="rowNum" assignto="{!rowNum}"/>
                    <apex:param value="" name="relatedListType" assignTo="{!relatedListType}"/>
               </apex:actionFunction>   
       
    
                <apex:actionFunction name="editStageAction"  action="{!edittask}" id="editactionid" rerender="viewPanel" oncomplete="" status="actStatusId">
                    <apex:param value="" name="rowNum" assignto="{!rowNum}"/>
                    <apex:param value="" name="relatedListType" assignTo="{!relatedListType}"/>
                </apex:actionFunction>
                
                
                
                <apex:actionFunction name="viewlinehistory"  action="{!lineitemapprovalhistory}" id="getdynamictablerecid" rerender="viewPanel"  status="actStatusId">
                
                    <apex:param id="row1" name="rowNum1" value="" assignto="{!rowNum}"/>
                    <apex:param id="rlt1" name="relatedListType1" value="{!relatedListType11}"/>
                    
                </apex:actionFunction>
                
                
                
                
                <apex:actionFunction name="deleteStageAction"  action="{!deletetask}" id="deleteactionid" rerender="viewPanel,,ActivityViewBlock"  status="actStatusId">
                    <apex:param value="" name="rowNum" assignto="{!rowNum}"/>
                    <apex:param value="" name="relatedListType" assignTo="{!relatedListType}"/>
                </apex:actionFunction>
                <apex:actionFunction name="cancelStageAction"  action="{!cancelTask}" id="cancelactionid" rerender="viewPanel" oncomplete=""  immediate="true" status="actStatusId">
                    <apex:param value="" name="rowNum" assignto="{!rowNum}"/>
                    <apex:param value="" name="relatedListType" assignTo="{!relatedListType}"/>
                </apex:actionFunction>
                
                 <apex:actionFunction name="actionFunforApproval"  action="{!approvalitems}"  rerender="viewPanel"  oncomplete="callTableSaveState();" status="actStatusId">
                     <apex:param name="event" value="view" assignTo="{!event}" />
                 </apex:actionFunction>
                  <apex:actionFunction name="cancelUpload"  action="{!cancelUpload}"  rerender="viewPanel"   status="actStatusId"/>
                  <apex:actionFunction name="callsaveActivitys" action="{!editActivity}"  rerender="viewPanel" status="actStatusId"  oncomplete="callTablegrid();" >
                  <apex:param name="event" value="view" assignTo="{!event}" />
                     </apex:actionFunction>
                     
                     <!--  For popup code displaying the brand values -->
                     
                     <div id="popDiv" class="ontop1">
                     
                    
                 
            <table border="1" id="popup1">
            
                <tr>
              
                    <td>
                  <div  class="popupclosebtn"> <a href="#" onClick="hide('popDiv')"> X </a></div>  
                    <!--    This is can be used as a popup1 window  -->
                    <!--    <apex:inputtext id="oldBrands" onclick="getpath(this.id)"/>   <br/>  -->
                        <p id="oldBrands" >   ..</p>   
                        
                    </td>
                </tr>
             <!--      <tr><td>
          <apex:commandButton id="closepopup" value="Close"  styleClass="btn-1"  onClick="hide('popDiv')">
                                    
                                </apex:commandButton>   
                <input type="button" id="closepopup" value="Close"  styleClass="btn btn-1" style="border-radius: 4px;background-color: #31ABC9 
                border: medium none; color: #fff; padding: 3px 10px;" onClick="hide('popDiv')" />
                                    
                                                
                                
                                </td></tr> -->
                                 
            </table>
            
        </div>
       <!-- <CENTER>
            <h3>
                Simple popup1 div with disabled background
            </h3>
            <br/>
            <a href="#" onClick="pop('popDiv')">Click here to open a popup1 div</a>
        </CENTER>  -->
                             
                
        </apex:form>
        
        
        
        <apex:form id="attachform">
                <apex:pageblock rendered="{!AND(OR(event=='view', event=='edit'),isAttach==true)}"  ><!-- tabstyle="Account"  Removed Tab style due to permission issue for account object Removed By: Keyur Modi(@KVP)--> 
                     <apex:pageblockbuttons >
                        <apex:commandbutton value="  Upload  "  action="{!upload}"  id="uploadid"/>
                        <apex:commandbutton value="  Cancel  "  action="{!cancelUpload}"/>
                    </apex:pageblockbuttons>
                    
                    <apex:pageblocksection title="Attach File to {!record['Name__c']}">
                   <!--  <apex:pageMessages id="pageMsg"></apex:pageMessages> -->
                        <apex:pageblocksectionitem >
                            <apex:outputlabel value="File"/>
                            <apex:inputfile value="{!attach1.body}"  id="filess"  filename="{!attach1.name}"/>
                        </apex:pageblocksectionitem>
                        <apex:pageblocksectionitem >
                            <apex:outputlabel value="Description"/>
                            <apex:inputfield value="{!attach1.Description}"/>
                        </apex:pageblocksectionitem>
                        
                        
                    </apex:pageblocksection>
                    
                    
                     
                    
                    
                </apex:pageblock>
            
                
                
          
                
        </apex:form>
        
        
            
          <script src="/soap/ajax/9.0/connection.js" type="text/javascript"></script>       
           <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"/>
           <script id="clientEventHandlersJS" type="javascript"></script>    
      
        <script type="text/javascript">
            var previousOnload = window.onload; window.onload = function() { if (previousOnload) { previousOnload(); } onLoad(); }
            $(document).ready(function() {
                    callTablegrid();
            });
            function callTablegrid(){
            
                $('.ActivityClass').closest('tr').addClass('bg-Activity');
                $('.SubActivityClass').closest('tr').addClass('bg-SubActivity');
                $('.SubStageClass').closest('tr').addClass('bg-SubStage');
                $('.StageClass').closest('tr').addClass('bg-Stage');
                $('.table-design p:contains("Completed")').closest('td').addClass('op-completed');
                $('.table-design p:contains("In Progress")').closest('td').addClass('op-inprogress');
                $('.table-design p:contains("Click to Deactivate")').closest('td').addClass('op-activity');
                
                $('.tree').treegrid();
                $('.tree-2').treegrid({
                    expanderExpandedClass: 'glyphicon glyphicon-minus',
                    expanderCollapsedClass: 'glyphicon glyphicon-plus',
                    'initialState': 'collapsed',
                        'saveState': true,
                        
                });
            }
            
             function collapseall()
                {
                  $("#tableId").treegrid('getRootNodes').treegrid('collapseRecursive');
                }
           
            
            function callpopupIDS(name,brand)
           {
    
         if(name=='Marketing Brief/Concept' && brand!=null){
          
          sforce.connection.sessionId = '{!$Api.Session_ID}';
          var qr1 = sforce.connection.query("SELECT id,NPD_Collections__c,NPD_Collections__r.Collection_Name__c,NPD_Collections__r.Tentative_Launch_Month_Date__c,Name__c,Brand1__c,NPD_Collections__r.CreatedDate,NPD_Collections__r.Team_Leader2__c,NPD_Collections__r.SF_Project_Owner__c from NPD_stage__c WHERE Name__c ='Concept Finalization' and Brand1__c='"+brand+"' and Status__c !='Completed' and NPD_Project_Name__r.Name='Marketing Brief/Concept Stage' and NPD_Collections__r.Collection_Name__c!=NULL");  
                console.log('qrrrrrrr111'+qr1);
                
                var records = qr1.getArray("records");
                var collect=[];
                 //var collect1=[];
           if (qr1.size > 1)
            {
              collect = collect + '<div class="table_design"><table> <tr><th> Collection Name</th>'+'<th>Tentative Launch Month/Date</th>'+'<th>Team Leader</th>'+'<th>Project Owner</th>'+'<th>CreatedDate</th>'+'</tr>';
                for (var i=0;i<qr1.size ;i++)
                {
                 collect=collect+'<tr><td>'+qr1.records[i].NPD_Collections__r.Collection_Name__c+'</td><td>'+qr1.records[i].NPD_Collections__r.Tentative_Launch_Month_Date__c+'</td><td>'+qr1.records[i].NPD_Collections__r.Team_Leader2__c+'</td><td>'+qr1.records[i].NPD_Collections__r.SF_Project_Owner__c+'</td><td>'+qr1.records[i].NPD_Collections__r.CreatedDate+'</td></tr>';
                 
                 
                 //collect1=collect1+','+'\n'+qr1.records[i].NPD_Collections__c
                 
                 
                }
                
                collect = collect + '</table></div>';
                
            //  document.getElementById("j_id0:form:oldBrands").value='THE other related collections under '+ brand +' brand are'+ collect;
                
                document.getElementById("oldBrands").innerHTML='<div class="popup_title">The other related collections under '+ brand +' brands </div>'+ collect;
                
                pop('popDiv');
            
        //  document.getElementById("oldBrands").value='THE other related Collections under '+ brand +' brand are'+ collect;
                
              //  alert('THE other related Collections under '+ brand +' brand are'+ collect);  
              // callsaveActivitys();
            }
            
            
        }  
        
         // callsaveActivitys();
            
            }
            
            
            
            $(function () {
      $('[data-toggle="tooltip"]').tooltip()
    })
            
            
             function editprojectdata1(recId,event){
                    
                mapEditvalueAf(recId,event);
                storeProjectId();
            }
        
            function ShowLoading() {
                document.getElementById('blockbckanim').style.display="block";
            }
            function HideLoading() {
                document.getElementById('blockbckanim').style.display="none";
            }
            function editprojectdata(recId,event){
                    
                mapEditvalueAf(recId,event);
                storeProjectId();
            }
        
            function ShowLoading() {
                document.getElementById('blockbckanim').style.display="block";
            }
            function HideLoading() {
                document.getElementById('blockbckanim').style.display="none";
            }
            var picklistValue;
           function changevalue(t){
                picklistValue=t;
            }
            
            function editStageTask(row,recType) {
                
                editStageAction(row,recType);
            }
            
            function viewhistory(row,recType) {
               
                viewlinehistory(row,recType);
            }
            
            function deleteStageTask(row,recType){
           var r1=confirm("You want to delete this record ? ");
            if(r1==true){
                deleteStageAction(row,recType);
                }
                
            }
            function saveStageTask(row,recType) {
                saveStageAction(row,recType);
          
           /*    $('body,html').animate({
            scrollTop: 0
        });   */
            }
            
            
            function saveStageTask1(row,recType) {
                saveStageAction2(row,recType);
          
           /*    $('body,html').animate({
            scrollTop: 0
        });   */
            }
            
            
            
            function cancelStageTask(row,recType) {
                
               var r1=confirm("You want to Cancel this record update ? ");
            if(r1==true){
                cancelStageAction(row,recType);
                }
            }
            
            function downLoadAttac(attId) {
                var urlAtt = '/servlet/servlet.FileDownload?file='+attId;
                window.open(urlAtt, 'Popup6','height=500,width=600,left=100,top=100,resizable=no,scrollbars=yes,toolbar=no,status=no');
            }
            
            
            
            //Brand Pop up
             function OpenBrandPopup1(BrandComponent)
        {     
            
            var url="/apex/NPD_Brand_Popup?"+"&BrandComponent="+BrandComponent;
            newWin=window.open(url, 'Popup3','height=400,width=300,left=100,top=50,resizable=no,scrollbars=yes,toolbar=no,status=no');
            
            if (window.focus) 
            {
                newWin.focus();
            }    
            
            return false;
        }
        
        
        
        function OpenSubBrandPopup1(SubBrandComponent,brandValue)
        {     
            var Brand = document.getElementById(brandValue).value;
              
            var url="/apex/NPD_SubBrand_Popup?"+"&SubBrandComponent="+SubBrandComponent+"&brandValue="+Brand;
            newWin=window.open(url, 'Popup3','height=400,width=300,left=100,top=50,resizable=no,scrollbars=yes,toolbar=no,status=no');
            
            if (window.focus) 
            {
                newWin.focus();
            }    
            
            return false;
        }
               
               function openComplexityTypePopup(comTyp,comCat,leadtime,title,type,source)
        {     
            //var compString = document.getElementById(comTyp).value;
              
            var url="/apex/NPD_Complexity_Type_Popup?"+"&comType="+comTyp+"&comCat="+comCat+"&leadtime="+leadtime+"&title="+title+"&type="+type+"&source="+source;
            newWin=window.open(url, 'Popup4','height=400,width=300,left=100,top=50,resizable=no,scrollbars=yes,toolbar=no,status=no');
            
            if (window.focus) 
            {
                newWin.focus();
            }    
            
            return false;
        }
        
        function popupforassigntask(taskid)
        {     
            
            var url="/apex/popupforassigntask?"+"&taskid="+taskid;
            newWin=window.open(url, 'Popup3','height=400,width=300,left=100,top=50,resizable=no,scrollbars=yes,toolbar=no,status=no');
            
            if (window.focus) 
            {
                newWin.focus();
            }    
            
            return false;
        }
        
        function showpopForstage(stagetype){
        
        console.log(stagetype);
        console.log(picklistValue);
        
        
      
        if(stagetype=='Stage' && picklistValue=='IDS'){
                alert('Please enter details of activity Briefing to IDS');
            
            }
            if(stagetype=='Stage' && picklistValue=='OSD'){
                alert('Please enter details of activity Briefing to OSD');
            
            }
          }  
       
        
        
        
        
        
        var picklistValue;
        function changevalue(t){
            picklistValue=t;
        }
             
             $(document).ready(function(){  
        
        $('.table-design span:contains("Stage")').closest('tr').addClass('green');
    
           var spanValues = $('tr.dataRow td:nth-child(2) span').map(function(){
                 return $(this).text();
            }).get(); 
            console.log('spanValues'+spanValues);       
        });
        
               
          function closeComplexitypopup() { 
         if (null!=newWin) {
              newWin.close(); 
          }
         }  
         
          function showerrordynamictable(err){
        
            var errormsg=jQuery('.errormsgId').html(err);
            if(err=='Saved Successfully'){
            
                errormsg.addClass('successmsgId');
            }
            else{
            
                errormsg.addClass('errormsgId');
            }
        
        }
        
        function callApprovalProcess(){
            var r=confirm("Record will not able to edit after sending it to Approval Process.\nAre you sure want to send for Approval Process?");
            if(r==true){
                actionFunforApproval();
                
            }
        
        }
        
        function openComplexityPopup(comTyp,comCat,leadtime,title,type)
        {     
            var compString = document.getElementById(comTyp).value;
              
            var url="/apex/NPD_Complexity_Popup?"+"&comType="+compString+"&comCat="+comCat+"&leadtime="+leadtime+"&title="+title+"&type="+type ;
            newWin=window.open(url, 'Popup3','height=400,width=300,left=100,top=50,resizable=no,scrollbars=yes,toolbar=no,status=no');
            
            if (window.focus) 
            {
                newWin.focus();
            }    
            
            return false;
        }
        
        function closemypopup(idd)
        {
       
        //var id1=idd;
        //var x=id1.lastIndexOf(":");
        
       
        //var y=id1.substring(0,x);
    
    
        document.getElementById(idd).style.display = "none";
    
        }
        
       function openMarketStage(marketId){
           marketId = marketId.substring(0,15)
           window.open('/apex/NPD_DetailView_Page?proID='+marketId);
       }
        
        
        </script> 
        
        
        
        
      
    </apex:page>